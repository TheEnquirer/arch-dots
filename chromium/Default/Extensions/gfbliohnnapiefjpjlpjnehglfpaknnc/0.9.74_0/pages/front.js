"use strict";var Front=function(){function t(t,e,n){this.enter=function(){n&&n(),top.postMessage({action:"setFrontFrame",pointerEvents:t,frameHeight:e},d)},this.nextState=function(){var t=Array.from(document.body.querySelectorAll("body>div")).filter(function(t){return"none"!==t.style.display}),e=t.map(function(t){var e=t.id,n=["sk_keystroke","sk_banner"];return n.indexOf(e)===-1&&("sk_status"===e?null!==c.statusBar.querySelector("input"):!t.noPointerEvents)});e.push(!1),e=e.reduce(function(t,e){return t||e});var n;n=e?f:t.length>0?h:p,this!==n&&(m=n,m.enter())}}function e(){E.remove("sk_scroller_indicator_top"),E.remove("sk_scroller_indicator_middle"),E.remove("sk_scroller_indicator_bottom")}function n(t,e){H&&"none"!==H.style.display&&(H.style.display="none",H.onHide&&H.onHide()),H=t,H.style.display="",H.onShow&&H.onShow(e)}function o(t,e){c.enter(0,!0),n(t,e),c.flush()}function i(t,e){var n=["Help","Mouse Click","Scroll Page / Element","Tabs","Page Navigation","Sessions","Search selected with","Clipboard","Omnibar","Visual Mode","vim-like marks","Settings","Chrome URLs","Proxy","Misc","Insert Mode"];initL10n(function(o){var i=n.map(function(){return[]});i[0].push("<div><span class=kbd-span><kbd>&lt;Alt-s&gt;</kbd></span><span class=annotation>{0}</span></div>".format(o("Toggle SurfingKeys on current site"))),t=t.concat(getAnnotations(Omnibar.mappings)),t.forEach(function(t){var e=KeyboardUtils.decodeKeystroke(t.word),n="<div><span class=kbd-span><kbd>".concat(htmlEncode(e),"</kbd></span><span class=annotation>").concat(o(t.annotation),"</span></div>");i[t.feature_group].push(n)}),i=i.map(function(t,e){return t.length?"<div><div class=feature_name><span>{0}</span></div>{1}</div>".format(o(n[e]),t.join("")):""}).join(""),i+="<p style='float:right; width:100%; text-align:right'><a href='https://github.com/brookhong/surfingkeys' target='_blank' style='color:#0095dd'>".concat(o("More help"),"</a></p>"),e(i)})}function s(){C&&(clearTimeout(C),C=void 0)}function a(t){initL10n(function(e){var n=t.accumulated,o=t.candidates;n=Object.keys(o).sort().map(function(n){var i=o[n];return i.annotation?"<div><span class=kbd-span><kbd>".concat(htmlEncode(KeyboardUtils.decodeKeystroke(t.accumulated)),"<span class=candidates>").concat(n.substr(t.accumulated.length),"</span></kbd></span><span class=annotation>").concat(e(i.annotation),"</span></div>"):""}).join(""),n.length>0&&C&&(setSanitizedContent(x,n),x.classList.add("expandRichHints"),c.flush())})}function r(){"none"!==v.style.display&&Front.contentCommand({action:"updateInlineQuery"})}window.KeyboardUtils=createKeyboardUtils(),window.Mode=createMode(),window.Normal=createNormal(),window.PassThrough=createPassThrough(),window.Visual=createVisual(),window.Hints=createHints(),window.Clipboard=createClipboard();var d,c=new Mode("Front"),l={},u={};c.contentCommand=function(t,e){t.commandToContent=!0,t.id=generateQuickGuid(),e&&(t.ack=!0,u[t.id]=e),top.postMessage(t,d)},c.addEventListener("keydown",function(t){Mode.isSpecialKeyOf("<Esc>",t.sk_keyName)?(c.hidePopup(),t.sk_stopPropagation=!0):k.trie&&(k.trie=k.trie.find(t.sk_keyName),k.trie?k.trie.meta&&(RUNTIME("focusTab",{windowId:k.trie.meta.windowId,tabId:k.trie.meta.id}),c.hidePopup(),k.trie=null):(c.hidePopup(),k.trie=null),t.sk_stopPropagation=!0)});var p=new t("none","0px"),h=new t("none","100%"),f=new t("all","100%",function(){window.focus()}),m=p;c.flush=function(){m.nextState()},c.visualCommand=function(t){"none"!==y.style.display?Visual[t.action](t.query):c.contentCommand(t)},c.omnibar=document.getElementById("sk_omnibar"),c.statusBar=document.getElementById("sk_status");var y=document.getElementById("sk_usage"),g=document.getElementById("sk_popup"),w=document.getElementById("sk_editor"),k=document.getElementById("sk_tabs"),b=document.getElementById("sk_banner"),v=document.getElementById("sk_bubble"),_=v.querySelector("div.sk_bubble_content"),S=v.querySelector("div.sk_arrow"),E=_.classList;_.onscroll=function(t){e(),0===this.scrollTop?E.add("sk_scroller_indicator_top"):this.scrollTop+this.offsetHeight>=this.scrollHeight?E.add("sk_scroller_indicator_bottom"):E.add("sk_scroller_indicator_middle")};var H,x=document.getElementById("sk_keystroke");l.hidePopup=function(){H&&"none"!==H.style.display&&(H.style.display="none",c.flush(),H.onHide&&H.onHide(),c.exit())},c.hidePopup=l.hidePopup,k.onShow=function(t){setSanitizedContent(k,""),k.trie=new Trie;var e=Hints.genLabels(t.length);t.forEach(function(t,n){var o=document.createElement("div");o.setAttribute("class","sk_tab"),o.style.width="200px",k.trie.add(e[n].toLowerCase(),t),setSanitizedContent(o,"<div class=sk_tab_hint>".concat(e[n],"</div><div class=sk_tab_wrap><div class=sk_tab_icon><img src='chrome://favicon/").concat(t.url,"'></div><div class=sk_tab_title>").concat(htmlEncode(t.title),"</div></div>")),o.url=t.url,k.append(o)}),k.querySelectorAll("div.sk_tab").forEach(function(t){t.append(createElementWithContent("div",t.url,{"class":"sk_tab_url"}))})},l.chooseTab=function(){RUNTIME("getTabs",null,function(t){t.tabs.length>runtime.conf.tabsThreshold?o(c.omnibar,{type:"Tabs"}):t.tabs.length>0&&o(k,t.tabs)})},y.onShow=function(t){i(t.metas,function(t){setSanitizedContent(y,t)})},l.showUsage=function(t){o(y,t)},l.applyUserSettings=function(t){for(var e in t.userSettings)runtime.conf.hasOwnProperty(e)&&(runtime.conf[e]=t.userSettings[e]);"theme"in t.userSettings&&setSanitizedContent(document.getElementById("sk_theme"),t.userSettings.theme)},l.executeCommand=function(t){Commands.execute(t.cmdline)},l.addMapkey=function(t){t.old_keystroke in Mode.specialKeys?Mode.specialKeys[t.old_keystroke].push(t.new_keystroke):window.hasOwnProperty(t.mode)&&_map(window[t.mode],t.new_keystroke,t.old_keystroke)},l.addVimMap=function(t){c.vimMappings.push([t.lhs,t.rhs,t.ctx])},l.addVimKeyMap=function(t){c.vimKeyMap=t.vimKeyMap},l.addSearchAlias=function(t){SearchEngine.aliases[t.alias]={prompt:""+t.prompt+separatorHtml,url:t.url,suggestionURL:t.suggestionURL}},l.removeSearchAlias=function(t){delete SearchEngine.aliases[t.alias]},l.getUsage=function(t){delete t.ack,i(t.metas,function(e){top.postMessage({data:e,action:t.action+"Ack",responseToContent:t.commandToFrontend,id:t.id},d)})},c.showUsage=c.hidePopup,l.showPopup=function(t){c.showPopup(t.content)},c.showPopup=function(t){setSanitizedContent(g,t),o(g)},c.vimMappings=[],w.onShow=function(t){"undefined"!=typeof AceEditor?AceEditor.show(t):Normal.insertJS("../libs/ace/ace.js",function(){ace.config.set("workerPath","../libs/ace"),ace.config.set("modePath","../libs/ace"),ace.config.set("themePath","../libs/ace"),ace.config.set("basePath","../libs/ace"),Normal.insertJS("editor.js",function(){AceEditor.show(t)})})},l.showEditor=function(t){t.onEditorSaved&&(c.onEditorSaved=t.onEditorSaved),o(w,t)},c.showEditor=l.showEditor,l.updateOmnibarResult=function(t){Omnibar.listWords(t.words)},l.openOmnibar=function(t){o(c.omnibar,t);var e=t.style||"";setSanitizedContent(c.omnibar.querySelector("style"),"#sk_omnibar {".concat(e,"}"))},c.openOmnibar=l.openOmnibar,l.openFinder=function(){Find.open()},c.openFinder=l.openFinder,c.showBanner=function(t,e){b.style.cssText="",b.style.display="",b.style.top="0px",setSanitizedContent(b,htmlEncode(t)),c.flush();var n=e||1600;setTimeout(function(){b.style.cssText="",b.style.display="none",c.flush()},n)},l.showBanner=function(t){c.showBanner(t.content,t.linger_time)},l.showBubble=function(t){var o=t.position;o.left+=o.winX,o.top+=o.winY,v.style.top="0px",v.style.left="0px",setSanitizedContent(_,t.content),_.style.maxWidth=o.winWidth-32+"px",_.scrollTop=0,e(),v.style.display="";var i=v.offsetWidth,s=v.offsetHeight,a=[o.left-11-i/2,i/2];a[0]<o.winX?(a[1]+=a[0]-o.winX,a[0]=o.winX):a[0]+i>o.winWidth&&(a[1]+=a[0]-o.winX-o.winWidth+i,a[0]=o.winX+o.winWidth-i),S.style.left=a[1]+o.width/2-2+"px",v.style.left=a[0]+"px",v.noPointerEvents=t.noPointerEvents,o.top+o.height/2>o.winHeight/2?(S.setAttribute("dir","down"),S.style.top="100%",_.style.maxHeight=o.top-12-32+"px",s=v.offsetHeight,v.style.top=o.top-s-12+"px"):(S.setAttribute("dir","up"),S.style.top="-12px",_.style.maxHeight=o.winHeight-(o.top+o.height+12)-32+"px",s=v.offsetHeight,v.style.top=o.top+o.height+12+"px"),_.scrollHeight>_.offsetHeight&&(v.noPointerEvents=!1,E.add("sk_scroller_indicator_top")),c.flush(),v.noPointerEvents||(n(v,{}),c.enter(0,!0))},c.showBubble=function(){},l.hideBubble=function(){v.style.display="none",c.flush()},c.hideBubble=l.hideBubble,l.visualUpdatedForFirefox=function(t){c.statusBar.querySelector("input").focus()},l.showStatus=function(t){Mode.stack()[0]!==Find&&c.showStatus(t.position,t.content,t.duration)},c.showStatus=function(t,e,n){StatusBar.show(t,e,n)},c.toggleStatus=function(t){t?c.statusBar.style.display="":c.statusBar.style.display="none"},l.toggleStatus=function(t){c.toggleStatus(t.visible)};var C;return l.hideKeystroke=function(){"none"!==x.style.display&&(x.classList.remove("expandRichHints"),setSanitizedContent(x,""),x.style.display="none",c.flush()),runtime.conf.richHintsForKeystroke>0&&runtime.conf.richHintsForKeystroke<1e4&&s()},c.hideKeystroke=l.hideKeystroke,Visual.mappings.add("y",{annotation:"Yank a word(w) or line(l) or sentence(s) or paragraph(p)",feature_group:9}),l.showKeystroke=function(t){if("none"!==x.style.display&&x.classList.contains("expandRichHints"))a(t.keyHints);else{s(),x.style.display="",c.flush();var e=x.innerHTML+htmlEncode(KeyboardUtils.decodeKeystroke(t.keyHints.key));setSanitizedContent(x,e),runtime.conf.richHintsForKeystroke>0&&runtime.conf.richHintsForKeystroke<1e4&&(C=setTimeout(function(){a(t.keyHints)},runtime.conf.richHintsForKeystroke))}},c.showKeystroke=function(){},l.initFrontend=function(t){return d=t.origin,(new Date).getTime()},window.addEventListener("message",function(t){var e=t.data;if(u[e.id]){var n=u[e.id];n(e)||delete u[e.id]}else if(e.action&&l.hasOwnProperty(e.action)){var o=l[e.action](e);e.ack&&top.postMessage({data:o,action:e.action+"Ack",responseToContent:e.commandToFrontend,id:e.id},d)}},!0),document.onmouseup=function(t){if(v.contains(t.target)){var e=window.getSelection().toString().trim()||Normal.getWordUnderCursor();e&&e.length>0&&Front.contentCommand({action:"updateInlineQuery",word:e},function(){window.addEventListener("resize",r)})}else v.style.display="none",Front.flush(),Front.visualCommand({action:"emptySelection"}),window.removeEventListener("resize",r)},v.querySelector("div.sk_bubble_content").addEventListener("mousewheel",function(t){(t.deltaY>0&&this.scrollTop+this.offsetHeight>=this.scrollHeight||t.deltaY<0&&this.scrollTop<=0)&&t.preventDefault()},{passive:!1}),window.addEventListener("beforeunload",function(){top.postMessage({action:"frontendUnloaded"},d)}),c}();