"use strict";function createKeyTarget(e,n,t){var i={code:e};return t&&(i.repeatIgnore=t),n&&(n=_parseAnnotation(n),i.feature_group=n.feature_group,i.annotation=n.annotation),i}function _isDomainApplicable(e){return!e||e.test(document.location.href)||e.test(window.origin)}function _mapkey(e,n,t,i,o){if(o=o||{},_isDomainApplicable(o.domain)){n=KeyboardUtils.encodeKeystroke(n);var a=e.mappings.remove(n);if(a){var r;r=a.meta?"".concat(a.meta.word," for [").concat(a.meta.annotation,"] is overridden by [").concat(t,"]."):a.getMetas(function(){return!0}).map(function(e){return"".concat(e.word," for [").concat(e.annotation,"] is overridden by [").concat(t,"].")}),console.warn(r)}else if(n.length>1)for(var s=n.substr(0,n.length-1);s.length>0;){if(a=e.mappings.find(s),a&&a.meta)return void console.warn("".concat(a.meta.word," for [").concat(a.meta.annotation,"] precedes ").concat(n,"."));s=s.substr(0,s.length-1)}var c=createKeyTarget(i,{annotation:t,feature_group:e===Visual?9:14},o.repeatIgnore);e.mappings.add(n,c)}}function mapkey(e,n,t,i){_mapkey(Normal,e,n,t,i)}function vmapkey(e,n,t,i){_mapkey(Visual,e,n,t,i)}function imapkey(e,n,t,i){_mapkey(Insert,e,n,t,i)}function map(e,n,t,i){if(_isDomainApplicable(t))if(":"===n[0]){var o=n.substr(1),a=createKeyTarget(function(){Front.executeCommand(o)},i?_parseAnnotation({annotation:i}):null,!1);Normal.mappings.add(KeyboardUtils.encodeKeystroke(e),a)}else!_map(Normal,e,n)&&n in Mode.specialKeys&&(Mode.specialKeys[n].push(e),Front.addMapkey("Mode",e,n))}function unmap(e,n){if(_isDomainApplicable(n)){var t=Normal.mappings.find(KeyboardUtils.encodeKeystroke(e));if(t)Normal.mappings.remove(KeyboardUtils.encodeKeystroke(e));else for(var i in Mode.specialKeys){var o=Mode.specialKeys[i].indexOf(e);o!==-1&&Mode.specialKeys[i].splice(o,1)}}}function unmapAllExcept(e,n){if(_isDomainApplicable(n)){var t=[Normal,Insert];t.forEach(function(n){var t=new Trie;e=e||[];for(var i=0,o=e.length;i<o;i++){var a=KeyboardUtils.encodeKeystroke(e[i]),r=n.mappings.find(a);r&&t.add(a,r.meta)}delete n.mappings,n.mappings=t,n.map_node=t})}}function imap(e,n,t,i){_isDomainApplicable(t)&&_map(Insert,e,n)}function iunmap(e,n){_isDomainApplicable(n)&&Insert.mappings.remove(KeyboardUtils.encodeKeystroke(e))}function cmap(e,n,t,i){_isDomainApplicable(t)&&Front.addMapkey("Omnibar",e,n)}function vmap(e,n,t,i){_isDomainApplicable(t)&&_map(Visual,e,n)}function vunmap(e,n){_isDomainApplicable(n)&&Visual.mappings.remove(KeyboardUtils.encodeKeystroke(e))}function aceVimMap(e,n,t){Front.addVimMap(e,n,t)}function addVimMapKey(){Front.addVimKeyMap(Array.from(arguments))}function addSearchAlias(e,n,t,i,o){Front.addSearchAlias(e,n,t,i,o)}function removeSearchAlias(e){Front.removeSearchAlias(e)}function addSearchAliasX(e,n,t,i,o,a,r){function s(){searchSelectedWith(t)}function c(){searchSelectedWith(t,!0)}addSearchAlias(e,n,t,o,a),mapkey((i||"s")+e,"#6Search selected with "+n,s),vmapkey((i||"s")+e,"",s),mapkey((i||"s")+(r||"o")+e,"",c),vmapkey((i||"s")+(r||"o")+e,"",c);var d=e.toUpperCase();if(d!==e){var u=function(){searchSelectedWith(t,!1,!0,e)},l=function(){searchSelectedWith(t,!0,!0,e)};mapkey((i||"s")+d,"",u),vmapkey((i||"s")+d,"",u),mapkey((i||"s")+(r||"o")+d,"",l),vmapkey((i||"s")+(r||"o")+d,"",l)}}function removeSearchAliasX(e,n,t){removeSearchAlias(e),unmap((n||"s")+e),vunmap((n||"s")+e),unmap((n||"s")+(t||"o")+e),vunmap((n||"s")+(t||"o")+e);var i=e.toUpperCase();i!==e&&(unmap((n||"s")+i),vunmap((n||"s")+i),unmap((n||"s")+(t||"o")+i),vunmap((n||"s")+(t||"o")+i))}function walkPageUrl(e){for(var n=0;n<runtime.conf.pageUrlRegex.length;n++){var t=window.location.href.match(runtime.conf.pageUrlRegex[n]);if(t&&4===t.length){var i=parseInt(t[2]);if(i<4294967295)return window.location.href=t[1]+(i+e)+t[3],!0}}return!1}function previousPage(){var e=uniqueLinks(getClickableElements("[rel=prev]",runtime.conf.prevLinkRegex));return e.length?(clickOn(e),!0):walkPageUrl(-1)}function nextPage(){var e=uniqueLinks(getClickableElements("[rel=next]",runtime.conf.nextLinkRegex));return e.length?(clickOn(e),!0):walkPageUrl(1)}function uniqueLinks(e){var n={};return e.forEach(function(e){var t=e.getAttribute("href");n[t]||(n[t]=e)}),Object.values(n)}function searchSelectedWith(e,n,t,i){Clipboard.read(function(o){var a=window.getSelection().toString()||o.data;n&&(a="site:"+window.location.hostname+" "+a),t?Front.openOmnibar({type:"SearchEngine",extra:i,pref:a}):tabOpenLink(constructSearchURL(e,encodeURIComponent(a)))})}function clickOn(e,n){"string"==typeof e&&(e=getClickableElements(e)),e.length>1?n?e.forEach(function(e){Hints.dispatchMouseClick(e)}):Hints.create(e,Hints.dispatchMouseClick):1===e.length&&Hints.dispatchMouseClick(e[0])}function getFormData(e,n){var t=new FormData(e);if("json"===n){var i={};return t.forEach(function(e,n){if(i.hasOwnProperty(n)){if(e.length){var t=i[n];"Array"===t.constructor.name?t.push(e):(i[n]=[],t.length&&i[n].push(t),i[n].push(e))}}else i[n]=e}),i}return new URLSearchParams(t).toString()}function httpRequest(e,n){e.method="get",RUNTIME("request",e,n)}function runScript(e){var n={settings:{},error:""};try{var t=new Function("settings",e);t(n.settings)}catch(i){n.error=i.toString()}return n}function applySettings(e,n){for(var t in e)runtime.conf.hasOwnProperty(t)&&(runtime.conf[t]=e[t]);if("findHistory"in e&&(runtime.conf.lastQuery=e.findHistory.length?e.findHistory[0]:""),"snippets"in e&&e.snippets&&!isInUIFrame()){var i=runScript(e.snippets);if(""!==i.error&&(window===top?Front.showPopup("Error found in settings: "+i.error):console.log("Error found in settings({0}): {1}".format(window.location.href,i.error))),!isEmptyObject(i.settings)){Front.setUserSettings(JSON.parse(JSON.stringify(i.settings)));for(var t in i.settings)runtime.conf.hasOwnProperty(t)&&(runtime.conf[t]=i.settings[t],delete i.settings[t]);Object.keys(i.settings).length>0&&window===top&&RUNTIME("updateSettings",{scope:"snippets",settings:i.settings})}}runtime.conf.showProxyInStatusBar&&"proxyMode"in e&&(["byhost","always"].indexOf(e.proxyMode)!==-1?Front.showStatus(3,"{0}: {1}".format(e.proxyMode,e.proxy)):Front.showStatus(3,e.proxyMode)),RUNTIME("getDisabled",{blacklistPattern:runtime.conf.blacklistPattern?runtime.conf.blacklistPattern.toJSON():""},function(e){e.disabled?Normal.disable():"application/pdf"!==document.contentType||e.noPdfViewer?(n&&n(window.location.href),Normal.enable()):usePdfViewer(),window===top&&RUNTIME("setSurfingkeysIcon",{status:e.disabled})})}function _initModules(){window.KeyboardUtils=createKeyboardUtils(),window.Mode=createMode(),window.Observer=createObserver(),window.Normal=createNormal(),Normal.enter(),window.PassThrough=createPassThrough(),window.Insert=createInsert(),window.Visual=createVisual(),window.Hints=createHints(),window.Clipboard=createClipboard(),window.Front=createFront(),createDefaultMappings(),window.pdfGuard=new Promise(function(e,n){RUNTIME("getSettings",null,function(n){var t=n.settings;applySettings(t,e),document.dispatchEvent(new CustomEvent("surfingkeys:userSettingsLoaded",{detail:t}))})})}function _onSettingsUpdated(e){var n=e.settings;applySettings(n)}function _initContent(){if(window.frameId=generateQuickGuid(),runtime.on("settingsUpdated",_onSettingsUpdated),runtime.conf.stealFocusOnLoad&&!isInUIFrame()&&document.body&&document.body.childElementCount>1){var e=getRealEdit();e&&e.blur()}}function getFrameId(){return!window.frameId&&window.innerWidth>16&&window.innerHeight>16&&document.body&&document.body.childElementCount>0&&runtime.conf.ignoredFrameHosts.indexOf(window.origin)===-1&&(!window.frameElement||parseInt("0"+getComputedStyle(window.frameElement).zIndex)>=0&&window.frameElement.offsetWidth>16&&window.frameElement.offsetWidth>16)&&(_initModules(),_initContent()),window.frameId}window===top?(_initModules(),document.addEventListener("DOMContentLoaded",function(e){_initContent(),runtime.on("tabActivated",function(){window.uiHost||(window.uiHost=createUiHost(),document.documentElement.appendChild(window.uiHost)),window.uiHostDetaching&&(clearTimeout(window.uiHostDetaching),delete window.uiHostDetaching)}),runtime.on("tabDeactivated",function(){window.uiHost&&(window.uiHostDetaching=setTimeout(function(){window.uiHost.detach(),delete window.uiHost},3e3))}),window._setScrollPos=function(e,n){document.scrollingElement.scrollLeft=e,document.scrollingElement.scrollTop=n},RUNTIME("tabURLAccessed",{title:document.title,url:window.location.href},function(e){if(e.active&&!window.uiHost&&(window.uiHost=createUiHost(),window.pdfGuard.then(function(){document.documentElement.appendChild(window.uiHost)})),e.index>0){var n=function(){i=!0,document.title=t+" "+o},t=e.index,i=!1,o=document.title;new MutationObserver(function(e){i?i=!1:(o=document.title,n())}).observe(document.querySelector("title"),{childList:!0}),n(),runtime.on("tabIndexChange",function(e,i,o){e.index!==t&&(t=e.index,n())})}})},{once:!0})):(runtime.getTopURL(function(e){0===e.indexOf(chrome.extension.getURL(""))&&(_initModules(),_initContent())}),"dictorium:"===window.location.protocol?(_initModules(),_initContent()):setTimeout(function(){document.addEventListener("click",function(e){getFrameId()},{once:!0})},1));