"use strict";function _createForOfIteratorHelper(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=_unsupportedIterableToArray(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,u=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return a=e.done,e},e:function(e){u=!0,r=e},f:function(){try{a||null==t["return"]||t["return"]()}finally{if(u)throw r}}}}function _unsupportedIterableToArray(e,n){if(e){if("string"==typeof e)return _arrayLikeToArray(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,n):void 0}}function _arrayLikeToArray(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,o=new Array(n);t<n;t++)o[t]=e[t];return o}function createFront(){function e(e,n){e.commandToFrontend=!0,e.origin=getDocumentOrigin(),e.id=generateQuickGuid(),n&&(e.ack=!0,a[e.id]=n),r.then(function(){runtime.postTopMessage(e)})}function n(){return[Normal.mappings,Visual.mappings,Insert.mappings].map(getAnnotations).reduce(function(e,n){return e.concat(n)})}function t(e){"DIV"===f.nodeName?f.innerText=e:f.value=e;var n=document.createEvent("HTMLEvents");n.initEvent("change",!1,!0),f.dispatchEvent(n)}function o(){h&&(clearTimeout(h),h=void 0)}var i={},r=new Promise(function(e,n){window===top?i.resolve=e:e(window.location.href)}),a={},u=[];i.setUserSettings=function(e){u.push({action:"applyUserSettings",userSettings:e})},i.applyUserSettings=function(){var n,t=_createForOfIteratorHelper(u);try{for(t.s();!(n=t.n()).done;){var o=n.value;e(o)}}catch(i){t.e(i)}finally{t.f()}};var c={};i.addSearchAlias=function(e,n,t,o,i){o&&i&&(c[o]=i),u.push({action:"addSearchAlias",alias:e,prompt:n,url:t,suggestionURL:o})},i.removeSearchAlias=function(e){u.push({action:"removeSearchAlias",alias:e})};var s={};i.performInlineQueryOnSelection=function(e){var n=document.getSelection().getRangeAt(0).getClientRects()[0];Front.performInlineQuery(e,n,function(e,n){n&&Front.showBubble({top:e.top,left:e.left,height:e.height,width:e.width},n,!1)})},i.querySelectedWord=function(){var e=document.getSelection(),n=e.toString().trim();n&&!/[\W_]/.test(n)&&n.length&&"Range"===e.type&&i.performInlineQueryOnSelection(n)},s.updateInlineQuery=function(e){e.word?i.performInlineQueryOnSelection(e.word):i.querySelectedWord()},s.getSearchSuggestions=function(e){var n=null;return c.hasOwnProperty(e.url)&&(n=c[e.url](e.response)),n},i.executeCommand=function(n){e({action:"executeCommand",cmdline:n})},i.addMapkey=function(e,n,t){u.push({action:"addMapkey",mode:e,new_keystroke:n,old_keystroke:t})},i.addVimMap=function(e,n,t){u.push({action:"addVimMap",lhs:e,rhs:n,ctx:t})},i.addVimKeyMap=function(e){u.push({action:"addVimKeyMap",vimKeyMap:e})};var d=createElementWithContent("div","Hi, I'm here now!",{id:"sk_frame"});d.fromSurfingKeys=!0,i.highlightElement=function(e){document.documentElement.append(d);var n=e.rect;d.style.top=n.top+"px",d.style.left=n.left+"px",d.style.width=n.width+"px",d.style.height=n.height+"px",d.style.display="",setTimeout(function(){d.remove()},e.duration)},i.showUsage=function(){e({action:"showUsage",metas:n()})},i.getUsage=function(t){e({action:"getUsage",metas:n()},function(e){t(e.data)})},i.showPopup=function(n){e({action:"showPopup",content:n})},i.hidePopup=function(){e({action:"hidePopup"})};var l,f;i.showEditor=function(n,o,i){var r,i=i||n.localName,a=0;if("string"==typeof n)r=n,f=document.body;else if("select"===i){var u=n.value;r=Array.from(n.querySelectorAll("option")).map(function(e,n){return e.value===u&&(a=n),e.innerText.trim()+" >< "+e.value}).join("\n"),f=n}else f=n,r="DIV"===f.nodeName?f.innerText:f.value;l=o||t,e({action:"showEditor",type:i||"textarea",initial_line:a,content:r})},i.chooseTab=function(){""!==Normal.repeats?RUNTIME("focusTabByIndex"):e({action:"chooseTab"})},i.openOmnibar=function(n){n.action="openOmnibar",e(n)};var p,m;i.performInlineQuery=function(e,n,t){void 0!==document.dictEnabled?("dictorium:"===window.location.protocol?window===top?window.location.href=e:window.postMessage({type:"DictoriumReload",word:e}):window.postMessage({type:"OpenDictoriumQuery",word:e,sentence:"",pos:n,source:window.location.href}),i.hidePopup()):p?(runtime.conf.autoSpeakOnInlineQuery&&readText(e),e=e.toLocaleLowerCase(),runtime.updateHistory("OmniQuery",e),httpRequest({url:"function"==typeof p.url?p.url(e):p.url+e,headers:p.headers},function(e){t(n,p.parseResult(e))})):isInUIFrame()?(m=function(e){t(n,e)},document.getElementById("proxyFrame").contentWindow.postMessage({action:"performInlineQuery",pos:n,query:e},"*")):(tabOpenLink("https://github.com/brookhong/Surfingkeys/wiki/Register-inline-query"),i.hidePopup())},i.registerInlineQuery=function(e){p=e},i.openOmniquery=function(e){i.openOmnibar({type:"OmniQuery",extra:e.query,style:e.style})},i.openFinder=function(){e({action:"openFinder"})},i.showBanner=function(n,t){e({action:"showBanner",content:n,linger_time:t})},i.showBubble=function(n,t,o){t.length>0&&(n.winWidth=window.innerWidth,n.winHeight=window.innerHeight,n.winX=0,n.winY=0,window.frameElement&&(n.winX=window.frameElement.offsetLeft,n.winY=window.frameElement.offsetTop),e({action:"showBubble",content:t,position:n,noPointerEvents:o}))},i.hideBubble=function(){e({action:"hideBubble"})};var y={accumulated:"",candidates:{},key:""};i.hideKeystroke=function(){y.accumulated="",y.candidates={},e({action:"hideKeystroke"})},i.showKeystroke=function(n,t){y.accumulated+=n,y.key=n,y.candidates={};var o=t.mappings.find(y.accumulated);o&&o.getMetas(function(e){return!0}).forEach(function(e){y.candidates[e.word]={annotation:e.annotation}}),e({action:"showKeystroke",keyHints:y})},i.showStatus=function(n,t,o){e({action:"showStatus",content:t,duration:o,position:n})},i.toggleStatus=function(n){e({action:"toggleStatus",visible:n})},s.ace_editor_saved=function(e){void 0!==e.data&&l(e.data),runtime.conf.focusOnSaved&&isEditable(f)&&(Normal.passFocus(!0),f.focus(),Insert.enter(f))},s.nextEdit=function(e){var n=Hints.getSelector()||"input, textarea, *[contenteditable=true], select";if(n=getElements(n),n.length){var t=n.indexOf(f);t=(t+(e.backward?-1:1))%n.length,n=n[t],scrollIntoViewIfNeeded(n),Hints.flashPressedLink(n),i.showEditor(n)}},s.omnibar_query_entered=function(n){runtime.updateHistory("OmniQuery",n.query),i.performInlineQuery(n.query,{top:0,left:80,height:0,width:100},function(t,o){if("Array"!==o.constructor.name&&(o=[o]),window.navigator.userAgent.indexOf("Firefox")===-1){var i=Visual.findSentenceOf(n.query);i.length>0&&o.push(i)}e({action:"updateOmnibarResult",words:o})})},s.executeScript=function(n){RUNTIME("executeScript",{code:n.cmdline},function(n){e({action:"updateOmnibarResult",words:n.response})})},s.getBackFocus=function(e){window.focus(),window===top&&window.uiHost&&window.uiHost.shadowRoot.contains(document.activeElement)&&document.activeElement.blur()},s.getPageText=function(e){return document.body.innerText};var h;s.visualUpdate=function(n){o(),h=setTimeout(function(){Visual.visualUpdateForContentWindow(n.query),window.navigator.userAgent.indexOf("Firefox")!==-1&&e({action:"visualUpdatedForFirefox"})},500)},s.visualClear=function(e){o(),Visual.visualClear()},s.visualEnter=function(e){o(),Visual.visualEnter(e.query)},s.emptySelection=function(e){document.getSelection().empty()};var w=!1;return s.deactivated=function(e){w=!1},s.activated=function(e){w=!0},runtime.on("focusFrame",function(e,n,t){e.frameId===window.frameId&&(window.focus(),document.body.scrollIntoView({behavior:"auto",block:"center",inline:"center"}),i.highlightElement({duration:500,rect:{top:0,left:0,width:window.innerWidth,height:window.innerHeight}}))}),window.addEventListener("message",function(e){var n=e.data;if(void 0!==n)if("performInlineQuery"===n.action)i.performInlineQuery(n.query,n.pos,function(n,t){e.source.postMessage({action:"performInlineQueryResult",pos:n,result:t},e.origin)});else if("performInlineQueryResult"===n.action)m(n.pos,n.result);else if(w){if(n.responseToContent&&a[n.id]){var t=a[n.id];t(n)||delete a[n.id]}else if(n.commandToContent&&n.action&&s.hasOwnProperty(n.action)){var o=s[n.action](n);n.ack&&runtime.postTopMessage({data:o,responseToFrontend:!0,origin:n.origin,id:n.id})}}else"activated"===n.action?s.activated(n):"DictoriumViewReady"===n.type&&s.activated(n)},!0),i}