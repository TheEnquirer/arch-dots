"use strict";function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n["return"]||n["return"]()}finally{if(s)throw i}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _regexFromString(str,highlight){var rxp=null;if(/^\/.+\/([gimuy]*)$/.test(str))try{rxp=eval(str)}catch(e){rxp=null}if(!rxp&&(/^\/.+$/.test(str)&&(rxp=eval(str+"/i")),!rxp))if(str=str.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&"),highlight)rxp=new RegExp(str.replace(/\s+/,"|"),"gi");else{var words=str.split(/\s+/).map(function(e){return"(?=.*".concat(e,")")}).join("");rxp=new RegExp("^".concat(words,".*$"),"gi")}return rxp}function _filterByTitleOrUrl(e,t){if(t&&t.length){var n=_regexFromString(t,!1);e=e.filter(function(e){return n.test(e.title)||n.test(e.url)})}return e}var separator="‚û§",separatorHtml="<span class='separator'>".concat(separator,"</span>"),Omnibar=function(){function e(e){Front.hidePopup(),setTimeout(e,100)}function t(e){var t=Array.from(a.resultsDiv.querySelectorAll("#sk_omnibarSearchResult>ul>li")),n=t.length;if(n>0){var r=a.resultsDiv.querySelector("li.focused");r&&r.classList.remove("focused");var o=t.indexOf(r);o=o===-1?n:o;var i=(e?o+n:o+n+2)%(n+1);i<n?(Omnibar.focusItem(t[i]),u.onTabKey&&u.onTabKey()):a.input.value=c}}function n(){c!==a.input.value&&(c=a.input.value),u.onInput&&u.onInput.call(this)}function r(e){u&&u.onKeydown&&u.onKeydown.call(e.target,e)&&e.preventDefault(),Mode.isSpecialKeyOf("<Esc>",e.sk_keyName)?(Front.hidePopup(),e.preventDefault()):e.keyCode===KeyboardUtils.keyCodes.enter?(u.activeTab=!e.ctrlKey,u.tabbed=Omnibar.tabbed^e.shiftKey,u.onEnter()&&Front.hidePopup()):e.keyCode===KeyboardUtils.keyCodes.space?a.expandAlias(a.input.value,"")&&e.preventDefault():e.keyCode===KeyboardUtils.keyCodes.backspace&&a.collapseAlias()&&e.preventDefault()}function o(){var e=document.createElement("input");return e.oninput=n,e.onkeydown=r,e.addEventListener("compositionstart",function(t){e.oninput=null,e.onkeydown=null}),e.addEventListener("compositionend",function(t){e.oninput=n,e.onkeydown=r,n()}),e}function i(){var e=(f-1)*g,t=e+g;t=t>b.length?b.length:t,setSanitizedContent(p,"".concat(e+1," - ").concat(t," / ").concat(b.length)),h=b.slice(e,t);var n=a.input.value.trim(),r=null;n.length&&(r=_regexFromString(n,!0)),a.listResults(h,function(e){var t;if(e.hasOwnProperty("html"))t=a.createItemFromRawHtml(e);else if(e.hasOwnProperty("url")&&void 0!==e.url){if(window.navigator.userAgent.indexOf("Firefox")!==-1&&/^(place|data):/i.test(e.url))return null;t=a.createURLItem(e,r)}else v&&(t=createElementWithContent("li",'<div class="title">‚ñ∑ '.concat(a.highlight(r,e.title),"</div>")),t.folder_name=e.title,t.folderId=e.id);return t})}var a=new Mode("Omnibar");a.addEventListener("keydown",function(e){e.sk_keyName.length&&Mode.handleMapKey.call(a,e),e.sk_suppressed=!0}).addEventListener("mousedown",function(e){e.sk_suppressed=!0}),a.mappings=new Trie,a.map_node=a.mappings,a.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-d>"),{annotation:"Delete focused item from bookmark or history",feature_group:8,code:function(){var e=Omnibar.resultsDiv.querySelector("li.focused");e&&e.uid&&RUNTIME("removeURL",{uid:e.uid},function(t){"Done"===t.response&&e.remove()})}}),a.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-i>"),{annotation:"Edit selected URL with vim editor, then open",feature_group:8,code:function(){var t=Omnibar.resultsDiv.querySelector("li.focused");if(t&&t.url)e(function(){Front.showEditor({initial_line:1,type:"url",content:t.url,onEditorSaved:function(e){e&&tabOpenLink(e)}})});else if(u===SearchEngine){var n=Omnibar.input.value,r=SearchEngine.url;e(function(){Front.showEditor({initial_line:1,type:"url",content:n,onEditorSaved:function(e){tabOpenLink(constructSearchURL(r,encodeURIComponent(e)))}})})}}}),a.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-j>"),{annotation:"Toggle Omnibar's position",feature_group:8,code:function(){"bottom"===runtime.conf.omnibarPosition?runtime.conf.omnibarPosition="middle":runtime.conf.omnibarPosition="bottom",e(function(){y.pref=a.input.value,Front.openOmnibar(y)})}}),a.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-.>"),{annotation:"Show results of next page",feature_group:8,code:function(){b&&(f*g<b.length?f++:f=1,i())}}),a.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-,>"),{annotation:"Show results of previous page",feature_group:8,code:function(){b&&(f>1?f--:f=Math.ceil(b.length/g),i())}}),a.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-c>"),{annotation:"Copy selected item url or all listed item urls",feature_group:8,code:function(){a.input.style.display="none";var e=Omnibar.resultsDiv.querySelector("li.focused"),t=e&&e.url?e.url:h.map(function(e){return e.url}).join("\n");Clipboard.write(t),a.input.style.display=""}}),a.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-D>"),{annotation:"Delete all listed items from bookmark or history",feature_group:8,code:function(){var e=Array.from(Omnibar.resultsDiv.querySelectorAll("#sk_omnibarSearchResult>ul>li")).map(function(e){return e.uid}).filter(function(e){return e});e.length&&RUNTIME("removeURL",{uid:e},function(e){"Done"===e.response&&(u&&u.getResults&&u.getResults(),Omnibar.triggerInput())})}}),a.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-r>"),{annotation:"Re-sort history by visitCount or lastVisitTime",feature_group:8,code:function(){u&&u.onReset&&u.onReset()}}),a.mappings.add(KeyboardUtils.encodeKeystroke("<Esc>"),{annotation:"Close Omnibar",feature_group:8,code:function(){Front.hidePopup()}}),a.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-m>"),{annotation:"Create vim-like mark for selected item",feature_group:8,code:function(e){var t=Omnibar.resultsDiv.querySelector("li.focused");t&&Normal.addVIMark(e,t.url)}});var s,u,l={},c="",d=null,m=Front.omnibar;m.onclick=function(e){u.onClick?u.onClick(e):a.input.focus()},a.triggerInput=function(){var e=new Event("input",{bubbles:!0,cancelable:!0});a.input.dispatchEvent(e)},a.expandAlias=function(e,t){var n=!1;return u!==SearchEngine&&e.length&&SearchEngine.aliases.hasOwnProperty(e)&&(d=u,u=SearchEngine,Object.assign(SearchEngine,SearchEngine.aliases[e]),setSanitizedContent(a.resultsDiv,""),setSanitizedContent(a.promptSpan,u.prompt),setSanitizedContent(p,""),b=null,a.collapsingPoint=t,a.input.value=t,t.length&&Omnibar.triggerInput(),n=!0),n},a.collapseAlias=function(){var e=!1,t=a.input.value;return!d||u===d||t!==a.collapsingPoint&&""!==t||(u=d,d=null,setSanitizedContent(a.promptSpan,u.prompt),t.length&&(a.input.value=t.substr(0,t.length-1)),Omnibar.triggerInput(),e=!0),e},a.focusItem=function(e){"string"==typeof e&&(e=a.resultsDiv.querySelector(e)),e.classList.add("focused"),scrollIntoViewIfNeeded(e)},a.promptSpan=m.querySelector("#sk_omnibarSearchArea>span.prompt");var p=m.querySelector("#sk_omnibarSearchArea>span.resultPage");a.resultsDiv=m.querySelector("#sk_omnibarSearchResult"),a.mappings.add(KeyboardUtils.encodeKeystroke("<Tab>"),{annotation:"Forward cycle through the candidates.",feature_group:8,code:function(){t("bottom"===runtime.conf.omnibarPosition)}}),a.mappings.add(KeyboardUtils.encodeKeystroke("<Shift-Tab>"),{annotation:"Backward cycle through the candidates.",feature_group:8,code:function(){t("bottom"!==runtime.conf.omnibarPosition)}}),a.mappings.add(KeyboardUtils.encodeKeystroke("<Ctrl-'>"),{annotation:"Toggle quotes in an input element",feature_group:8,code:toggleQuote}),a.highlight=function(e,t){return"data:image/"===t.substr(0,11)&&(t=t.substr(0,1024)),null===e?t:t.replace(e,function(e){return"<span class=omnibar_highlight>"+e+"</span>"})},a.createURLItem=function(e,t){e.title=e.title&&""!==e.title?e.title:e.url;var n="üî•",r="",o=e.uid;e.hasOwnProperty("lastVisitTime")?(n="üïú",r="<span class=omnibar_timestamp># ".concat(timeStampString(e.lastVisitTime),"</span>"),r+="<span class=omnibar_visitcount> (".concat(e.visitCount,")</span>"),o="H"+e.url):e.hasOwnProperty("dateAdded")?(n="‚≠ê",r="<span class=omnibar_folder>@ ".concat(s[e.parentId].title||"","</span> <span class=omnibar_timestamp># ").concat(timeStampString(e.dateAdded),"</span>"),o="B"+e.id):e.hasOwnProperty("width")?(n="üîñ",o="T"+e.windowId+":"+e.id):e.type&&2===e.type.length&&e.type.charCodeAt(0)>255&&(n=e.type);var i=createElementWithContent("li",'<div class="title">'.concat(n," ").concat(a.highlight(t,htmlEncode(e.title))," ").concat(r,'</div><div class="url">').concat(a.highlight(t,e.url),"</div>"));return i.uid=o,i.url=e.url,i},a.createItemFromRawHtml=function(e){var t=e.html,n=e.props,r=createElementWithContent("li",t);return"object"===_typeof(n)&&Object.assign(r,n),r},a.detectAndInsertURLItem=function(e,t){var n=/^(?:https?:\/\/)?(?:[^@\/\n]+@)?(?:www\.)?([^:\/\n\s]+)\.([^:\/\n\s]+)/i,r=/^https?:\/\/(?:[^@\/\n]+@)?([^:\/\n\s]+)/i;if(n.test(e)){var o=e;/^https?:\/\//.test(e)||(o="http://"+e),t.unshift({title:e,url:o})}else r.test(e)&&t.unshift({title:e,url:e})};var f,b,v,g,h;a.listURLs=function(e,t){g=runtime.conf.omnibarMaxResults||10,f=1,b=e,v=t,i()},a.getItems=function(){return b};var y;return m.onShow=function(e){a.input||(a.input=o(),document.querySelector("#sk_omnibarSearchArea").insertBefore(a.input,p)),y=e,m.classList.remove("sk_omnibar_middle"),m.classList.remove("sk_omnibar_bottom"),m.classList.add("sk_omnibar_"+runtime.conf.omnibarPosition),"bottom"===runtime.conf.omnibarPosition?(a.resultsDiv.remove(),m.insertBefore(a.resultsDiv,document.querySelector("#sk_omnibarSearchArea"))):(a.resultsDiv.remove(),m.append(a.resultsDiv)),a.tabbed=void 0===e.tabbed||e.tabbed,u=l[e.type],a.input.focus(),a.enter(),e.pref&&(a.input.value=e.pref),u.onOpen&&u.onOpen(e.extra),d=u,u=u,setSanitizedContent(a.promptSpan,u.prompt),setSanitizedContent(p,""),m.scrollTop=0},m.onHide=function(){delete a.cachedPromise,b=null,s=null,c="",a.input.value="",a.input.placeholder="",setSanitizedContent(a.resultsDiv,""),d=null,u.onClose&&u.onClose(),a.exit(),u=null},a.openFocused=function(){var e,t=a.resultsDiv.querySelector("li.focused");t?e=t.url:(e=a.input.value,e.indexOf(":")===-1&&(e=SearchEngine.aliases[runtime.conf.defaultSearchEngine].url+e));var n,r="";return t&&t.uid&&(n=t.uid,r=n[0],n=n.substr(1)),"T"===r?(n=n.split(":"),RUNTIME("focusTab",{windowId:parseInt(n[0]),tabId:parseInt(n[1])})):e&&e.length&&RUNTIME("openLink",{tab:{tabbed:this.tabbed,active:this.activeTab},url:e}),this.activeTab},a.listResults=function(e,t){if(setSanitizedContent(a.resultsDiv,""),e&&0!==e.length){"bottom"===runtime.conf.omnibarPosition&&e.reverse();var n=document.createElement("ul");if(e.forEach(function(e){var r=t(e);r&&n.append(r)}),a.resultsDiv.append(n),e=a.resultsDiv.querySelectorAll("#sk_omnibarSearchResult>ul>li"),runtime.conf.focusFirstCandidate||u.focusFirstCandidate){var r="bottom"===runtime.conf.omnibarPosition?e.length-1:0;e[r].classList.add("focused")}"bottom"===runtime.conf.omnibarPosition&&e.length>0&&scrollIntoViewIfNeeded(e[e.length-1])}},a.listWords=function(e){a.listResults(e,function(e){var t=createElementWithContent("li","‚åï ".concat(e));return t.query=e,t})},a.html=function(e){setSanitizedContent(a.resultsDiv,e)},a.addHandler=function(e,t){l[e]=t},a.listBookmarkFolders=function(e){RUNTIME("getBookmarkFolders",null,function(t){s={},t.folders.forEach(function(e){s[e.id]=e}),e&&e(t,s)})},a}(),OpenBookmarks=function(){function e(){var e=n.inFolder.pop();e.folderId?(t=e.folderId,RUNTIME("getBookmarks",{parentId:t},n.onResponse)):(t=void 0,RUNTIME("getBookmarks",null,n.onResponse)),n.prompt=e.prompt,setSanitizedContent(Omnibar.promptSpan,n.prompt),o=e.focused}var t,n={prompt:"bookmark".concat(separatorHtml),inFolder:[]},r=!1,o=0;return n.onEnter=function(){var e=Array.from(Omnibar.resultsDiv.querySelectorAll("#sk_omnibarSearchResult>ul>li")),r=!1,i=Omnibar.resultsDiv.querySelector("li.focused"),a=i.folderId;return a?(n.inFolder.push({prompt:n.prompt,folderId:t,focused:e.indexOf(i)}),n.prompt=i.folder_name+separator,setSanitizedContent(Omnibar.promptSpan,n.prompt),Omnibar.input.value="",t=a,o=0,RUNTIME("getBookmarks",{parentId:t},OpenBookmarks.onResponse)):(r=Omnibar.openFocused.call(n),r&&(n.inFolder.push({prompt:n.prompt,folderId:t,focused:e.indexOf(i)}),localStorage.setItem("surfingkeys.lastOpenBookmark",JSON.stringify(n.inFolder)))),r},n.onOpen=function(){Omnibar.listBookmarkFolders(function(){var t=localStorage.getItem("surfingkeys.lastOpenBookmark");t?(n.inFolder=JSON.parse(t),e()):RUNTIME("getBookmarks",null,n.onResponse),""!==Omnibar.input.value&&n.onInput()})},n.onClose=function(){n.inFolder=[],n.prompt="bookmark".concat(separatorHtml),t=void 0},n.onKeydown=function(o){var i=!1;if(o.keyCode===KeyboardUtils.keyCodes.comma)r=!r,n.prompt=r?"bookmark folder".concat(separator):"bookmark".concat(separator),setSanitizedContent(Omnibar.promptSpan,n.prompt),RUNTIME("getBookmarks",{parentId:t,query:Omnibar.input.value},n.onResponse),i=!0;else if(o.keyCode===KeyboardUtils.keyCodes.backspace&&n.inFolder.length&&!Omnibar.input.value.length)e(),i=!0;else if(o.ctrlKey&&o.shiftKey&&KeyboardUtils.isWordChar(o)){var a=Omnibar.resultsDiv.querySelector("li.focused");if(a){var s=String.fromCharCode(o.keyCode);Normal.addVIMark(s,a.url),i=!0}}return i},n.onInput=function(){RUNTIME("getBookmarks",{parentId:t,query:Omnibar.input.value},n.onResponse)},n.onResponse=function(e){var t=e.bookmarks;r&&(t=t.filter(function(e){return!e.hasOwnProperty("url")||void 0===e.url})),Omnibar.listURLs(t,!0);var t=Omnibar.resultsDiv.querySelectorAll("#sk_omnibarSearchResult>ul>li");Omnibar.focusItem(t[o])},n}();Omnibar.addHandler("Bookmarks",OpenBookmarks);var AddBookmark=function(){var e,t={focusFirstCandidate:!0,prompt:"add bookmark".concat(separatorHtml)};return t.onOpen=function(n){t.page=n,Omnibar.listBookmarkFolders(function(n){e=n.folders,Omnibar.listResults(e.slice(),function(e){return createElementWithContent("li","‚ñ∑ ".concat(e.title),{folder:e.id})}),RUNTIME("getBookmark",null,function(e){if(e.bookmarks.length){var n=e.bookmarks[0];setSanitizedContent(Omnibar.promptSpan,"edit bookmark".concat(separatorHtml)),Omnibar.resultsDiv.querySelector("li.focused").classList.remove("focused"),Omnibar.focusItem('li[folder="'.concat(n.parentId,'"]'))}var r=localStorage.getItem("surfingkeys.lastAddedBookmark");r&&(Omnibar.input.value=r,Omnibar.input.select(),t.onInput())})})},t.onTabKey=function(){var e=Omnibar.resultsDiv.querySelector("li.focused");Omnibar.input.value=e.innerHTML.substr(2)},t.onEnter=function(){t.page.path=[];var n,r=Omnibar.resultsDiv.querySelector("li.focused");if(r)t.page.folder=r.getAttribute("folder"),n=r.innerHTML.substr(2);else{var o=Omnibar.input.value;o=o.split("/");var i=o.pop();i.length&&(t.page.title=i),o=o.filter(function(e){return e.length>0});for(var a=o.length;a>0;a--){var s=e.filter(function(e){return e.title==="/".concat(o.slice(0,a).join("/"),"/")});if(s.length){t.page.folder=s[0].id,t.page.path=o.slice(a),n="/"+o.join("/");break}}void 0===t.page.folder&&(t.page.folder=e[0].id,t.page.path=o,n="".concat(e[0].title).concat(o.join("/")))}return RUNTIME("createBookmark",{page:t.page},function(e){Front.showBanner("Bookmark created at {0}.".format(n),3e3)}),localStorage.setItem("surfingkeys.lastAddedBookmark",Omnibar.input.value),!0},t.onInput=function(){var t=Omnibar.input.value,n=runtime.getCaseSensitive(t),r=e.filter(function(e){return n?e.title.indexOf(t)!==-1:e.title.toLowerCase().indexOf(t.toLowerCase())!==-1});Omnibar.listResults(r,function(e){return createElementWithContent("li","‚ñ∑ ".concat(e.title),{folder:e.id})})},t}();Omnibar.addHandler("AddBookmark",AddBookmark);var OpenHistory=function(){var e={prompt:"history".concat(separatorHtml)};return e.onOpen=function(t){e.getResults(),e.onInput()},e.getResults=function(){Omnibar.cachedPromise=new Promise(function(e,t){RUNTIME("getHistory",{sortByMostUsed:runtime.conf.historyMUOrder},function(t){e(t.history)})})},e.onReset=function(){runtime.conf.historyMUOrder=!runtime.conf.historyMUOrder,Omnibar.cachedPromise.then(function(e){e=runtime.conf.historyMUOrder?e.sort(function(e,t){return t.visitCount-e.visitCount}):e.sort(function(e,t){return t.lastVisitTime-e.lastVisitTime});var t=_filterByTitleOrUrl(e,Omnibar.input.value);Omnibar.listURLs(t,!1)})},e.onEnter=Omnibar.openFocused.bind(e),e.onInput=function(){Omnibar.cachedPromise.then(function(e){var t=_filterByTitleOrUrl(e,Omnibar.input.value);Omnibar.listURLs(t,!1)})},e}();Omnibar.addHandler("History",OpenHistory);var OpenURLs=function(){var e={prompt:"".concat(separatorHtml)};return e.getResults=function(){"getAllSites"===e.action?Omnibar.cachedPromise=new Promise(function(e,t){RUNTIME("getTabs",{queryInfo:runtime.conf.omnibarTabsQuery},function(t){var n=t.tabs;RUNTIME("getTopSites",null,function(t){n=n.concat(t.urls),Omnibar.listBookmarkFolders(function(){RUNTIME("getAllURLs",null,function(t){n=n.concat(t.urls),e(n)})})})})}):Omnibar.cachedPromise=new Promise(function(t,n){RUNTIME(e.action,null,function(e){t(e.urls)})})},e.onOpen=function(t){e.action=t,"getRecentlyClosed"===e.action?e.prompt="Recently closed".concat(separatorHtml):"getTabURLs"===e.action?e.prompt="Tab History".concat(separatorHtml):e.prompt="".concat(separatorHtml),e.getResults(),e.onInput()},e.onEnter=Omnibar.openFocused.bind(e),e.onInput=function(){Omnibar.cachedPromise.then(function(e){var t=Omnibar.input.value,n=_filterByTitleOrUrl(e,t);0===n.length?Omnibar.expandAlias(runtime.conf.defaultSearchEngine,t):(Omnibar.detectAndInsertURLItem(t,n),Omnibar.listURLs(n,!1))})},e}();Omnibar.addHandler("URLs",OpenURLs);var OpenTabs=function(){var e={focusFirstCandidate:!0},t={};return e.getResults=function(){Omnibar.cachedPromise=new Promise(function(e,n){RUNTIME("getTabs",t,function(t){e(t.tabs)})})},e.onOpen=function(n){n&&"gather"===n.action?(e.prompt="Gather filtered tabs into current window".concat(separatorHtml),e.onEnter=function(){return RUNTIME("gatherTabs",{tabs:Omnibar.getItems()}),!0},t={queryInfo:{currentWindow:!1}}):(e.prompt="tabs".concat(separatorHtml),e.onEnter=Omnibar.openFocused.bind(e),t={}),e.getResults(),e.onInput()},e.onInput=function(){Omnibar.cachedPromise.then(function(e){var t=_filterByTitleOrUrl(e,Omnibar.input.value);Omnibar.listURLs(t,!1)})},e}();Omnibar.addHandler("Tabs",OpenTabs);var OpenWindows=function(){var e={prompt:"Move current tab to window".concat(separatorHtml)};return e.getResults=function(){Omnibar.cachedPromise=new Promise(function(e,t){RUNTIME("getWindows",{query:""},function(t){e(t.windows)})})},e.onEnter=function(){var e=Omnibar.resultsDiv.querySelector("li.focused"),t=-1;return e&&void 0!==e.windowId&&(t=e.windowId),RUNTIME("moveToWindow",{windowId:t}),!0},e.onOpen=function(){Omnibar.input.placeholder="Press enter without focusing an item to move to a new window.",e.getResults(),e.onInput()},e.onInput=function(){Omnibar.cachedPromise.then(function(e){0===e.length&&(RUNTIME("moveToWindow",{windowId:-1}),Front.hidePopup());var t=e,n=Omnibar.input.value,r=null;n&&n.length&&(r=_regexFromString(n,!1),t=e.filter(function(e){var t,n=_createForOfIteratorHelper(e.tabs);try{for(n.s();!(t=n.n()).done;){var o=t.value;if(r.test(o.title)||r.test(o.url))return!0}}catch(i){n.e(i)}finally{n.f()}return!1})),r=_regexFromString(n,!0),Omnibar.listResults(t,function(e){var t=createElementWithContent("li");return t.windowId=parseInt(e.id),t.classList.add("window"),e.isPreviousChoice&&t.classList.add("focused"),e.tabs.forEach(function(e){var n=createElementWithContent("div","",{"class":"tab_in_window"});n.appendChild(createElementWithContent("div",Omnibar.highlight(r,e.title),{"class":"title"})),n.appendChild(createElementWithContent("div",Omnibar.highlight(r,new URL(e.url).origin),{"class":"url"})),t.appendChild(n)}),t.url=e.tabs.map(function(e){return e.url}).join("\n"),t})})},e}();Omnibar.addHandler("Windows",OpenWindows);var OpenVIMarks=function(){var e={focusFirstCandidate:!0,prompt:"VIMarks".concat(separatorHtml)};return e.onOpen=function(){var e=Omnibar.input.value,t=[];RUNTIME("getSettings",{key:"marks"},function(n){for(var r in n.settings.marks){var o=n.settings.marks[r];"string"==typeof o&&(o={url:o,scrollLeft:0,scrollTop:0}),""!==e&&o.url.indexOf(e)===-1||t.push({title:r,type:"üîó",uid:"M"+r,url:o.url})}Omnibar.listURLs(t,!1)})},e.onEnter=Omnibar.openFocused.bind(e),e.onInput=e.onOpen,e}();Omnibar.addHandler("VIMarks",OpenVIMarks);var SearchEngine=function(){function e(){o&&(clearTimeout(o),o=void 0)}function t(e,t){return e.indexOf("%s")!==-1?e.replace("%s",t):e+t}function n(e){Omnibar.detectAndInsertURLItem(Omnibar.input.value,e);var t=_regexFromString(encodeURIComponent(Omnibar.input.value),!0);Omnibar.listResults(e,function(e){if(e.hasOwnProperty("html"))return Omnibar.createItemFromRawHtml(e);if(e.hasOwnProperty("url"))return Omnibar.createURLItem(e,t);var n=createElementWithContent("li","‚åï ".concat(e));return n.query=e,n})}var r={};r.aliases={};var o=void 0;return r.onOpen=function(e){Object.assign(r,r.aliases[e]);var t=Omnibar.input.value;if(t.length){var n=t.match(/^(site:\S+\s*).*/);n&&Omnibar.input.setSelectionRange(n[1].length,t.length),Omnibar.triggerInput()}},r.onClose=function(){e(),r.prompt=void 0,r.url=void 0,r.suggestionURL=void 0},r.onTabKey=function(){var e=Omnibar.resultsDiv.querySelector("li.focused");e&&e.query&&(Omnibar.input.value=e.query)},r.onEnter=function(){var e,t=Omnibar.resultsDiv.querySelector("li.focused");return e=t?t.url||constructSearchURL(r.url,t.query||encodeURIComponent(Omnibar.input.value)):constructSearchURL(r.url,encodeURIComponent(Omnibar.input.value)),RUNTIME("openLink",{tab:{tabbed:this.tabbed,active:this.activeTab},url:e}),this.activeTab},r.onInput=function(){var i=r.suggestionURL,a=i&&runtime.conf.omnibarSuggestion;return a?(e(),void(o=setTimeout(function(){RUNTIME("request",{method:"get",url:t(r.suggestionURL,encodeURIComponent(Omnibar.input.value))},function(e){Front.contentCommand({action:"getSearchSuggestions",url:r.suggestionURL,response:e},function(e){e=e.data,Array.isArray(e)||(e=[]),n(e)})})},runtime.conf.omnibarSuggestionTimeout))):void n([])},r}();Omnibar.addHandler("SearchEngine",SearchEngine);var Commands=function(){function e(e){for(var e=e.trim(),t=[],n=!1,r="",o=0;o<e.length;o++)" "!==e.charAt(o)||n?'"'===e.charAt(o)?n=!n:r+=e.charAt(o):(t.push(r),r="");return t.push(r),t}var t={focusFirstCandidate:!0,prompt:":",items:{}},n=0;return t.onOpen=function(){n=-1,RUNTIME("getSettings",{key:"cmdHistory"},function(e){var t=e.settings.cmdHistory;t.length&&Omnibar.listResults(t,function(e){var t=createElementWithContent("li",e);return t.cmd=e,t})})},t.onReset=t.onOpen,t.onInput=function(){var e=Omnibar.input.value,n=Object.keys(t.items).filter(function(t){return""===e||t.indexOf(e)!==-1});n.length&&Omnibar.listResults(n,function(e){var n=createElementWithContent("li","".concat(e,"<span class=annotation>").concat(htmlEncode(t.items[e].annotation),"</span>"));return n.cmd=e,n})},t.onTabKey=function(){Omnibar.input.value=Omnibar.resultsDiv.querySelector("li.focused").cmd},t.onEnter=function(){var e=!1,n=Omnibar.input.value;return n.length&&(runtime.updateHistory("cmd",n),t.execute(n),Omnibar.input.value=""),e},t.execute=function(n){var r=e(n),o=r.shift();if(t.items.hasOwnProperty(o)){var i=t.items[o];i.code.call(i.code,r)}else Front.contentCommand({action:"executeScript",cmdline:n})},t}();Omnibar.addHandler("Commands",Commands);var OmniQuery=function(){function e(e,t,n){return n.indexOf(e)===t}var t,n={prompt:"«≠"};return n.onOpen=function(n){n&&(Omnibar.input.value=n,Front.contentCommand({action:"omnibar_query_entered",query:n})),Front.contentCommand({action:"getPageText"},function(n){var r=/[^a-zA-Z]+/;t=n.data.toLowerCase().split(r).filter(e)})},n.onInput=function(){var e=Omnibar.input.value,n=t.filter(function(t){return t.indexOf(e)!==-1});n.length&&Omnibar.listResults(n,function(e){return createElementWithContent("li",e)})},n.onTabKey=function(){Omnibar.input.value=Omnibar.resultsDiv.querySelector("li.focused").innerText},n.onEnter=function(){Front.contentCommand({action:"omnibar_query_entered",query:Omnibar.input.value})},n}();Omnibar.addHandler("OmniQuery",OmniQuery);var OpenUserURLs=function(){var e,t={focusFirstCandidate:!0,prompt:"UserURLs".concat(separatorHtml)};return t.onOpen=function(n){e=n,t.onInput()},t.onInput=function(){var t,n=Omnibar.input.value,r=[],o=_createForOfIteratorHelper(e);try{for(o.s();!(t=o.n()).done;){var i=t.value;""!==n&&i.title.indexOf(n)===-1&&i.url.indexOf(n)===-1||r.push({title:i.title,type:"üçÜ",url:i.url})}}catch(a){o.e(a)}finally{o.f()}Omnibar.listURLs(r,!1)},t.onEnter=Omnibar.openFocused.bind(t),t}();Omnibar.addHandler("UserURLs",OpenUserURLs);