(()=>{"use strict";var e={100:e=>{var t,s="object"==typeof Reflect?Reflect:null,n=s&&"function"==typeof s.apply?s.apply:function(e,t,s){return Function.prototype.apply.call(e,t,s)};t=s&&"function"==typeof s.ownKeys?s.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(s,n){function r(s){e.removeListener(t,a),n(s)}function a(){"function"==typeof e.removeListener&&e.removeListener("error",r),s([].slice.call(arguments))}v(e,t,a,{once:!0}),"error"!==t&&function(e,t,s){"function"==typeof e.on&&v(e,"error",t,{once:!0})}(e,r)}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var i=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function d(e,t,s,n){var r,a,i,d;if(o(s),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,s.listener?s.listener:s),a=e._events),i=a[t]),void 0===i)i=a[t]=s,++e._eventsCount;else if("function"==typeof i?i=a[t]=n?[s,i]:[i,s]:n?i.unshift(s):i.push(s),(r=c(e))>0&&i.length>r&&!i.warned){i.warned=!0;var g=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");g.name="MaxListenersExceededWarning",g.emitter=e,g.type=t,g.count=i.length,d=g,console&&console.warn&&console.warn(d)}return e}function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,s){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:s},r=g.bind(n);return r.listener=s,n.wrapFn=r,r}function l(e,t,s){var n=e._events;if(void 0===n)return[];var r=n[t];return void 0===r?[]:"function"==typeof r?s?[r.listener||r]:[r]:s?function(e){for(var t=new Array(e.length),s=0;s<t.length;++s)t[s]=e[s].listener||e[s];return t}(r):u(r,r.length)}function p(e){var t=this._events;if(void 0!==t){var s=t[e];if("function"==typeof s)return 1;if(void 0!==s)return s.length}return 0}function u(e,t){for(var s=new Array(t),n=0;n<t;++n)s[n]=e[n];return s}function v(e,t,s,n){if("function"==typeof e.on)n.once?e.once(t,s):e.on(t,s);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(a){n.once&&e.removeEventListener(t,r),s(a)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return i},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");i=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return c(this)},a.prototype.emit=function(e){for(var t=[],s=1;s<arguments.length;s++)t.push(arguments[s]);var r="error"===e,a=this._events;if(void 0!==a)r=r&&void 0===a.error;else if(!r)return!1;if(r){var i;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var o=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw o.context=i,o}var c=a[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else{var d=c.length,g=u(c,d);for(s=0;s<d;++s)n(g[s],this,t)}return!0},a.prototype.addListener=function(e,t){return d(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return d(this,e,t,!0)},a.prototype.once=function(e,t){return o(t),this.on(e,h(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,h(this,e,t)),this},a.prototype.removeListener=function(e,t){var s,n,r,a,i;if(o(t),void 0===(n=this._events))return this;if(void 0===(s=n[e]))return this;if(s===t||s.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,s.listener||t));else if("function"!=typeof s){for(r=-1,a=s.length-1;a>=0;a--)if(s[a]===t||s[a].listener===t){i=s[a].listener,r=a;break}if(r<0)return this;0===r?s.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(s,r),1===s.length&&(n[e]=s[0]),void 0!==n.removeListener&&this.emit("removeListener",e,i||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,s,n;if(void 0===(s=this._events))return this;if(void 0===s.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==s[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete s[e]),this;if(0===arguments.length){var r,a=Object.keys(s);for(n=0;n<a.length;++n)"removeListener"!==(r=a[n])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=s[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},a.prototype.listeners=function(e){return l(this,e,!0)},a.prototype.rawListeners=function(e){return l(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},a.prototype.listenerCount=p,a.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},396:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.reloadStartpagesInAllWindowsWhenInBackground=void 0;class s{constructor(e){this.onStartpageInWindowReloaded=e,this.windowsToWaitFor=new Set,this.tabActivatedListener=e=>this.onTabActivated(e),this.tabUpdatedListener=(e,t,s)=>this.onTabUpdated(e,t,s),this.windowRemovedListener=e=>this.onWindowRemoved(e),(async()=>{var e;const t=await new Promise((e=>chrome.windows.getAll((t=>e(t.filter((e=>"normal"===e.type||"popup"===e.type))))))),s=await Promise.all(t.map((e=>new Promise((t=>{chrome.tabs.query({active:!0,windowId:e.id},(s=>t({windowId:e.id,activeTab:s[0]})))})))));for(const t of s)(null===(e=t.activeTab.url)||void 0===e?void 0:e.startsWith("chrome://startpage"))?this.windowsToWaitFor.add(t.windowId):opr.speeddialPrivate.reloadInWindow(t.windowId,(()=>{}));0!==this.windowsToWaitFor.size&&(chrome.tabs.onActivated.addListener(this.tabActivatedListener),chrome.tabs.onUpdated.addListener(this.tabUpdatedListener),chrome.windows.onRemoved.addListener(this.windowRemovedListener))})()}onTabActivated(e){this.windowsToWaitFor.has(e.windowId)&&chrome.tabs.get(e.tabId,(e=>{this.reloadStartpageIfInBackground(e.windowId,e.url)}))}onTabUpdated(e,t,s){this.windowsToWaitFor.has(s.windowId)&&s.active&&t.url&&this.reloadStartpageIfInBackground(s.windowId,s.url)}onWindowRemoved(e){this.windowsToWaitFor.delete(e),this.onWindowHandled(e)}reloadStartpageIfInBackground(e,t){t.startsWith("chrome://startpage")||(opr.speeddialPrivate.reloadInWindow(e,(()=>{this.onStartpageInWindowReloaded(e)})),this.onWindowHandled(e))}onWindowHandled(e){this.windowsToWaitFor.delete(e),0===this.windowsToWaitFor.size&&(chrome.tabs.onActivated.removeListener(this.tabActivatedListener),chrome.tabs.onUpdated.removeListener(this.tabUpdatedListener),chrome.windows.onRemoved.removeListener(this.windowRemovedListener))}}t.reloadStartpagesInAllWindowsWhenInBackground=function(e){new s(e)}},410:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserLaunchedWithTagAssigned=void 0;class s{constructor(e){this.backend=e}static eventNameForTag(e){return`browser-launched-with-tag-${e}`}fireEvent(){opr.richHintsAgentPrivate.fireEvent({eventName:s.eventNameForTag(this.backend.tagName)})}async activate(){await this.backend.wasRecentlyLaunchedWithTag()&&this.fireEvent()}async deactivate(){}}t.BrowserLaunchedWithTagAssigned=s},783:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.CashbackBadgeShownEventSource=void 0,function(e){e[e.INITIALIZING_WINDOW=0]="INITIALIZING_WINDOW",e[e.COMPUTING_IF_COMMIT_CHECK_NEEDED=1]="COMPUTING_IF_COMMIT_CHECK_NEEDED",e[e.WATING_FOR_TAB_COMMIT=2]="WATING_FOR_TAB_COMMIT",e[e.IDLE=3]="IDLE"}(s||(s={}));class n{constructor(e){this.windowCreatedClosures=[],this._state=s.INITIALIZING_WINDOW,this._state=e?s.IDLE:s.INITIALIZING_WINDOW}get hasWindowData(){return this._state!==s.INITIALIZING_WINDOW}get computingIfCommitCheckNeeded(){return this._state===s.COMPUTING_IF_COMMIT_CHECK_NEEDED}get waitingForTabCommit(){return this._state===s.WATING_FOR_TAB_COMMIT}onWindowCreated(){var e;this._state=s.IDLE;for(const t of null!==(e=this.windowCreatedClosures)&&void 0!==e?e:[])t();this.windowCreatedClosures=[]}onComputingIfCommitCheckNeeded(){this._state=s.COMPUTING_IF_COMMIT_CHECK_NEEDED}waitForTabCommit(e){this._state=s.WATING_FOR_TAB_COMMIT;let t=this.stateClosure;this.stateClosure=e,t&&t()}onIdle(){this._state=s.IDLE}commitTab(){this._state=s.IDLE,this.stateClosure&&this.stateClosure(),this.stateClosure=void 0}addWindowReadyClosure(e){this.windowCreatedClosures.push(e)}setStateClosure(e){this.stateClosure=e}}class r{constructor(e){this.variableStore=e,this.cashbackStatesForWindows=new Map,this.cashbackBadgeStateChangedListener=(e,t)=>this.onCashbackStateChanged(e,t),this.windowCreatedListener=e=>this.onWindowCreated(e),this.windowRemovedListener=e=>this.onWindowRemoved(e),this.tabActivatedListener=e=>this.onTabActivated(e)}static isAvailable(){return void 0!==opr.cashbackPrivate}static registerVariables(e){for(const t in this.VARIABLES)e.registerStringVariable(t,this.VARIABLES[t].default)}getWindowState(e){let t=this.cashbackStatesForWindows.get(e);return t||(t={supported:!1,state:opr.cashbackPrivate.BadgeState.DISABLED,stateManager:new n(!1)},this.cashbackStatesForWindows.set(e,t),t)}getTabInfo(e){return new Promise((t=>{chrome.tabs.query(e,(e=>{t(e[0])}))}))}getCashbackBadgeState(e){return new Promise((t=>opr.cashbackPrivate.getCashbackBadgeState(e,t)))}async onCashbackStateChanged(e,t){const s=this.getWindowState(e);if(!s.stateManager.hasWindowData)return void s.stateManager.addWindowReadyClosure((()=>this.onCashbackStateChanged(e,t)));if(!s.supported)return;s.stateManager.onComputingIfCommitCheckNeeded();const n=await this.getTabInfo({active:!0,windowId:e});let r=()=>s.stateManager.onIdle();try{if(void 0===n)return void s.stateManager.onIdle();if(s.lastKnownActiveTabId!==n.id)return void(r=()=>s.stateManager.waitForTabCommit((()=>this.onCashbackStateChanged(e,t))));s.state===opr.cashbackPrivate.BadgeState.DISABLED&&t===opr.cashbackPrivate.BadgeState.IDLE&&await this.fireEvent(n.url),s.state=t}finally{r()}}onWindowCreated(e){const t=this.getWindowState(e.id);t.supported="normal"===e.type&&!e.incognito,t.stateManager.onWindowCreated()}onWindowRemoved(e){this.cashbackStatesForWindows.delete(e)}async onTabActivated(e){const t=this.getWindowState(e.windowId);if(t.stateManager.hasWindowData){if(t.supported)if(t.stateManager.computingIfCommitCheckNeeded)t.stateManager.setStateClosure((()=>this.onTabActivated(e)));else try{if(t.stateManager.waitingForTabCommit)return;const s=await this.getCashbackBadgeState(e.windowId);if(t.state=s,s!==opr.cashbackPrivate.BadgeState.IDLE)return;const n=await new Promise((t=>chrome.tabs.get(e.tabId,t)));await this.fireEvent(n.url)}finally{t.lastKnownActiveTabId=e.tabId,t.stateManager.commitTab()}}else t.stateManager.addWindowReadyClosure((()=>this.onTabActivated(e)))}async fireEvent(e){await this.variableStore.setString("page_with_cashback",e),await new Promise((e=>opr.richHintsAgentPrivate.fireEvent({eventName:r.NAME},e)))}async activate(){const e=await new Promise((e=>chrome.windows.getAll(e)));chrome.tabs.onActivated.addListener(this.tabActivatedListener),this.cashbackStatesForWindows=new Map(await Promise.all(e.map((e=>new Promise((async t=>{const s="normal"===e.type&&!e.incognito;t([e.id,{supported:s,state:s?await new Promise((t=>{opr.cashbackPrivate.getCashbackBadgeState(e.id,t)})):opr.cashbackPrivate.BadgeState.DISABLED,stateManager:new n(!0)}])})))))),chrome.windows.onCreated.addListener(this.windowCreatedListener),chrome.windows.onRemoved.addListener(this.windowRemovedListener),opr.cashbackPrivate.onCashbackBadgeStateChanged.addListener(this.cashbackBadgeStateChangedListener)}async deactivate(){chrome.tabs.onActivated.removeListener(this.tabActivatedListener),opr.cashbackPrivate.onCashbackBadgeStateChanged.removeListener(this.cashbackBadgeStateChangedListener),chrome.windows.onRemoved.removeListener(this.windowRemovedListener),chrome.windows.onCreated.removeListener(this.windowCreatedListener)}}t.CashbackBadgeShownEventSource=r,r.NAME="cashback-badge-shown",r.VARIABLES={page_with_cashback:{default:"none",description:"Page that generated the cashback-badge-shown event"}}},879:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DisplayTargetedSDSectionFunctionMessage=t.CallTestStartpageFunctionMessage=t.ACS_CallStartpageFunctionMessage=t.ACS_UseApiMessage=t.ContentScriptMessageWithApiType=t.ACS_ErrorMessage=t.CSA_StartpageAPIEventMessage=t.CSA_CallStartpageFunctionResponseMessage=t.ApiToContentScriptMessage=t.ContentScriptToApiMessage=t.ContentScriptConnectionMessage=void 0;class s{constructor(e,t){this.type=e,this.requestId=t,this.id=s.nextId++}}t.ContentScriptConnectionMessage=s,s.nextId=0;class n extends s{}t.ContentScriptToApiMessage=n;class r extends s{}t.ApiToContentScriptMessage=r;class a extends n{constructor(e,t,s){super("CSA_CallStartpageFunctionResponse",t),this.result=e,this.data=s}static fromRawMessage(e){if("CSA_CallStartpageFunctionResponse"!==e.type||"boolean"!=typeof e.result||"number"!=typeof e.requestId||"object"!=typeof e.data)throw new Error("Unparseable message");return new a(e.result,e.requestId,e.data)}}t.CSA_CallStartpageFunctionResponseMessage=a;class i extends n{constructor(e,t,s){super("CSA_StartpageAPIEvent"),this.result=e,this.name=t,this.data=s}static fromRawMessage(e){if("CSA_StartpageAPIEvent"!==e.type||"string"!=typeof e.name||"object"!=typeof e.data)throw new Error("Unparseable message");return new i(e.result,e.name,e.data)}}t.CSA_StartpageAPIEventMessage=i,t.ACS_ErrorMessage=class extends r{constructor(e){super("ACS_Error"),this.message=e}};class o extends r{constructor(e,t,s){super(e,s),this.functionName=t}}t.ContentScriptMessageWithApiType=o;class c extends o{constructor(e,t,s,n){super(e,t,s),this.params=n}}t.ACS_UseApiMessage=c;class d extends c{constructor(e,t,s,n){super(d.MESSAGE_TYPE,e,t,n),this.windowId=s}}t.ACS_CallStartpageFunctionMessage=d,d.MESSAGE_TYPE="ACS_CallStartpageFunction";class g extends d{constructor(e,t,s,n){super("TestStartpageFunction",e,t,{boxColour:s,text:n})}get boxColour(){return this.params.boxColour}get text(){return this.params.text}static fromParams(e,t,s){const n=s.get("colour");if("string"!=typeof n)throw new Error(`Bad colour ${n}`);const r=s.get("text");if("string"!=typeof n)throw new Error(`Bad colour ${n}`);return new g(e,t,n,r)}static fromRawMessage(e){if("object"!=typeof e.params)throw new Error("params not an object");if("string"!=typeof e.params.boxColour)throw new Error("boxColour not a string");if("string"!=typeof e.params.text)throw new Error("text not a string");return new g(e.requestId,e.windowId,e.params.boxColour,e.params.text)}}t.CallTestStartpageFunctionMessage=g;class h extends d{constructor(e,t,s,n,r,a){super("DisplayTargetedSDSection",e,t,{tiles:s,sectionTitle:n,menuOptionTitle:r,folded:a}),this.tiles=s,this.sectionTitle=n,this.menuOptionTitle=r,this.folded=a}static createTilesFromArray(e){let t=[];for(let s of e){if("string"!=typeof s.clickUrl)throw new Error("tiles[i].clickUrl must be a string");if("string"!=typeof s.imageUrl)throw new Error("tiles[i].imageUrl must be a string");if("string"!=typeof s.title)throw new Error("tiles[i].title must be a string");t.push({clickUrl:s.clickUrl,imageUrl:s.imageUrl,title:s.title})}return t}static fromParams(e,t,s){const n=s.get("tiles");if(!(n instanceof Array))throw new Error("tiles should be an array");const r=s.get("sectionTitle");if("string"!=typeof r)throw new Error("sectionTitle should be a string");const a=s.get("menuOptionTitle");if("string"!=typeof a)throw new Error("menuOptionTitle should be a string");const i=s.get("folded");if("boolean"!=typeof i)throw new Error("folded should be a boolean");return new h(e,t,h.createTilesFromArray(n),r,a,i)}static fromRawMessage(e){if("object"!=typeof e.params)throw new Error("params not an object");if(!(e.params.tiles instanceof Array))throw new Error("params.tiles not an array");if("string"!=typeof e.params.sectionTitle)throw new Error("sectionTitle should be a string");if("string"!=typeof e.params.menuOptionTitle)throw new Error("menuOptionTitle should be a string");if("boolean"!=typeof e.params.folded)throw new Error("folded should be a boolean");return new h(e.requestId,e.windowId,h.createTilesFromArray(e.tiles),e.params.sectionTitle,e.params.menuOptionTitle,e.params.folded)}}t.DisplayTargetedSDSectionFunctionMessage=h},727:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventRegistry=void 0;const n=s(100);t.EventRegistry=class{constructor(e,t,s){this.onSpecificationUpdated=e,this.provideEvents=t,this.eventSourceFactory=s,this.eventsSources=new Map,this.eventEmitter=new n.EventEmitter,this.onSpecificationUpdated.addListener((()=>{this.registerEvents()}))}on(e,t){this.eventEmitter.on(e,t)}removeListener(e,t){this.eventEmitter.removeListener(e,t)}registerEvents(){this.eventEmitter.emit("start-providing-events"),this.provideEvents(this.eventSourceFactory.getSupportedEvents(),(e=>{let t=Array.from(this.eventsSources.keys()),s=e.filter((e=>-1===t.indexOf(e))),n=t.filter((t=>-1===e.indexOf(t)));s.forEach((e=>{let t=this.eventSourceFactory.createEventSource(e);t?(this.eventsSources.set(e,t),t.activate(this)):console.warn("The event "+t+" is unknown and cannot be handled")})),n.forEach((e=>{this.eventsSources.get(e).deactivate(this),this.eventsSources.delete(e)}))}))}}},533:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventSourceFactoryImpl=void 0,t.EventSourceFactoryImpl=class{constructor(e){this.eventFactories=e}createEventSource(e){let t=this.eventFactories.get(e);return t?t():null}getSupportedEvents(){return Array.from(this.eventFactories.keys())}}},796:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.checkExtensionLaunchType=void 0,t.checkExtensionLaunchType=async function(){const e=await new Promise((e=>chrome.storage.local.get("launch_type_check",(t=>{var s;return e(null!==(s=t.launch_type_check)&&void 0!==s?s:{})})))),t=chrome.runtime.getManifest().version,s=e.last_recorded_version===t?"browser_launch":"extension_update";return e.last_recorded_version=t,await new Promise((t=>chrome.storage.local.set({launch_type_check:e},t))),s}},683:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExternalConnectionBroker=t.defaultExternalConnectionPortFactory=t.ExternalConnectionPort=void 0;const n=s(100),r=s(895);class a{constructor(e,t,s){this.rawPort=t,this.portId=s,this.eventEmitter=new n.EventEmitter,t.onMessage.addListener((t=>{try{const s=e.parse(t);s.port=this,this.eventEmitter.emit("message",s)}catch(e){this.postMessage(new r.AC_ErrorMessage(e.message))}})),t.onDisconnect.addListener((e=>{this.eventEmitter.emit("disconnect",this)}))}onMessage(e){this.eventEmitter.on("message",e)}onDisconnect(e){this.eventEmitter.on("disconnect",e)}removeMessageListener(e){this.eventEmitter.removeListener("message",e)}removeDisconnectListener(e){this.eventEmitter.removeListener("disconnect",e)}postMessage(e){this.rawPort.postMessage(e)}}t.ExternalConnectionPort=a,t.defaultExternalConnectionPortFactory=function(e,t,s){return new a(e,t,s)},t.ExternalConnectionBroker=class{constructor(e,t){this.listenersForAPIs=new Map,this.nextPortId=0,chrome.runtime.onConnectExternal.addListener((s=>{const n=this.listenersForAPIs.get(s.name);if(!n)return s.postMessage(new r.AC_ErrorMessage(`No known API for ${s.name}`)),void s.disconnect();n(t(e,s,this.nextPortId++))}))}registerConnectionListener(e,t){if(this.listenersForAPIs.has(e))throw new Error("Listener already registered");this.listenersForAPIs.set(e,t)}}},895:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExternalConnectionMessageParser=t.AC_ErrorMessage=t.ExternalConnectionClientToApiMessage=t.ExternalConnectionApiToClientMessage=t.ExternalConnectionMessage=void 0;class s{constructor(e){this.type=e,this.id=s.nextId++}}t.ExternalConnectionMessage=s,s.nextId=0;class n extends s{}t.ExternalConnectionApiToClientMessage=n,t.ExternalConnectionClientToApiMessage=class extends s{get port(){return this._port}set port(e){this._port=e}},t.AC_ErrorMessage=class extends n{constructor(e){super("AC_Error"),this.message=e}},t.ExternalConnectionMessageParser=class{constructor(){this.parsers=new Map}registerMessageParser(e,t){this.parsers.set(e,t)}parse(e){const t=e.type;if("string"!=typeof t)throw new Error("Unreadable message type");const s=this.parsers.get(t);if(!s)throw new Error(`Unknown message type ${t}`);return s(e)}}},324:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTag=t.MatcherRegex=void 0;class s{constructor(e){this.regex=new RegExp(e)}isMatch(e){return this.regex.test(e)}}t.MatcherRegex=s;class n{constructor(e,t,s,n,r,a){this.matchers=e,this.negative_matchers=t,this.tag=s,this.search_limit_days=n,this.min_matchers_to_qualify=r,this.active=a}static createFromJson(e){return e.map((e=>new n(e.matchers.map((e=>new s(e))),e.negative_matchers.map((e=>new s(e))),e.tag,e.search_limit_days,e.min_matchers_to_qualify,e.active)))}}t.HistoryTag=n},842:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTagAssignedEventSource=void 0;class s{constructor(e){this.backend=e,this.tagAssignedCallback=()=>{this.fireEvent()}}static eventNameForTag(e){return`history-tag-assigned-${e}`}fireEvent(){opr.richHintsAgentPrivate.fireEvent({eventName:s.eventNameForTag(this.backend.tagName)})}async activate(e){this.backend.watchForTagAssignment(e)&&this.backend.on("tag-assigned-at-random-time",this.tagAssignedCallback)}async deactivate(e){this.backend.stopWatching(e),this.backend.removeListener("tag-assigned-at-random-time",this.tagAssignedCallback)}}t.HistoryTagAssignedEventSource=s},907:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTagEventsBackend=void 0;const n=s(100);class r{}class a{constructor(e,t,s,r,a,i,o){this.tagName=e,this.storageKey=t,this.extensionLaunchType=s,this.extensionLaunchTime=r,this.historyTagUpdater=a,this.historyTagStorage=i,this.state=o,this.eventEmitter=new n.EventEmitter,this.tagsChangedEventListener=()=>{this.reportTagAssigned()},this.watching=!1}static async make(e,t,s,n,i,o){const c=await new Promise((t=>chrome.storage.local.get(e,(s=>{var n;return t(null!==(n=s[e])&&void 0!==n?n:new r)}))));return c.tag_assigned_event_reported=!0===c.tag_assigned_event_reported,new a(n,e,s,t,i,o,c)}static getDefaultStorageKey(e){return`history_tag_assigned_event_source_${e}`}async wasRecentlyLaunchedWithTag(){const e=Date.now();return!("browser_launch"!==this.extensionLaunchType||e-this.extensionLaunchTime>a.LAUNCH_DELAY)&&(await this.historyTagUpdater.waitForPendingUpdate(),this.historyTagStorage.hasTag(this.tagName))}watchForTagAssignment(e){return!this.state.tag_assigned_event_reported&&(this.historyTagStorage.on("tags-changed",this.tagsChangedEventListener),this.watching=!0,!0)}stopWatching(e){this.watching&&(this.historyTagStorage.removeListener("tags-changed",this.tagsChangedEventListener),this.watching=!1)}on(e,t){this.eventEmitter.on(e,t)}removeListener(e,t){this.eventEmitter.removeListener(e,t)}async saveState(){chrome.storage.local.set({[this.storageKey]:this.state})}async setAlreadyReported(){this.state.tag_assigned_event_reported=!0,await this.saveState()}async reportTagAssigned(){!this.state.tag_assigned_event_reported&&this.historyTagStorage.hasTag(this.tagName)&&(await this.setAlreadyReported(),this.eventEmitter.emit("tag-assigned-at-random-time"))}}t.HistoryTagEventsBackend=a,a.CHECK_INTERVAL=18e5,a.LAUNCH_DELAY=2e4},166:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTagStorage=void 0;const n=s(100),r=s(324);class a{constructor(e,t){this.tagState=e,this.variableStore=t,this.eventEmitter=new n.EventEmitter}hasTag(e){return!0===this.tagState.get(e)}static tagNameToStorageName(e){return`history_tag_${e}`}stateToStorage(){const e={history_tags:{}};return this.tagState.forEach(((t,s)=>e.history_tags[s]=t)),e}static async readHistoryTagsFromJson(e){const t=await fetch(chrome.runtime.getURL(e)),s=await t.json();return r.HistoryTag.createFromJson(s).filter((e=>e.active))}static registerVariables(e,t){t.forEach((t=>e.registerIntVariable(a.tagNameToStorageName(t.tag),0)))}static async load(e,t){const s=await new Promise((t=>chrome.storage.local.get(e,t))),n=new Map(Object.keys(s).map((e=>[e,!0===s[e]])));return new a(n,t)}on(e,t){this.eventEmitter.on(e,t)}removeListener(e,t){this.eventEmitter.removeListener(e,t)}async save(e){const t=Array.from(e.keys()).some((t=>this.tagState.get(t)!==e.get(t)))||Array.from(this.tagState.keys()).some((t=>this.tagState.get(t)!==e.get(t)));this.tagState=e;const s=this.stateToStorage();await new Promise((e=>chrome.storage.local.set(s,e)));for(const e of Array.from(this.tagState.entries()))await this.variableStore.setInt(a.tagNameToStorageName(e[0]),e[1]?1:0,"dont_flush");await this.variableStore.save(),t&&this.eventEmitter.emit("tags-changed")}}t.HistoryTagStorage=a},722:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryTagUpdater=void 0;class s{constructor(e,t,s){this.storage=e,this.tags=t,setInterval((()=>this.updateTags()),s)}init(e){e.on("start-providing-events",(()=>{this.updateTags()}))}async updateTags(){this.updatingAfterSpecChangePromise||(this.updatingAfterSpecChangePromise=(async()=>{await this.storage.save(await this.calculateTagsFromHistory())})(),await this.updatingAfterSpecChangePromise,this.updatingAfterSpecChangePromise=void 0)}async waitForPendingUpdate(){return this.updatingAfterSpecChangePromise?this.updatingAfterSpecChangePromise:Promise.resolve()}async searchHistory(e){return new Promise((t=>chrome.history.search({text:"",startTime:e,maxResults:1e5},t)))}anyResultMatches(e,t,s){return e.some((e=>!(!e.lastVisitTime||e.lastVisitTime<s)&&void 0!==t.find((t=>t.isMatch(e.url)))))}nResultsMatch(e,t,s,n){let r=Array.from(new Set(e.flat().map((e=>{if(e.lastVisitTime&&!(e.lastVisitTime<n))return void 0!==t.find((t=>t.isMatch(e.url)))?e.url:void 0})).filter((e=>e)).map((e=>e))));return t.filter((e=>r.some((t=>e.isMatch(t))))).length>=s}async calculateTagsFromHistory(){const e=Math.max(...this.tags.map((e=>e.search_limit_days))),t=await this.searchHistory(e);return new Map(await Promise.all(this.tags.map((async e=>{const n=Date.now()-e.search_limit_days*s.DAYS_TO_MS;return this.anyResultMatches(t,e.negative_matchers,n)?[e.tag,!1]:[e.tag,this.nResultsMatch(t,e.matchers,e.min_matchers_to_qualify,n)]}))))}}t.HistoryTagUpdater=s,s.DAYS_TO_MS=864e5},89:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InjectionBasedPageApiManager=t.InjectionBasedStartpageApi=t.InjectionBasedPageApi=t.StartpageContentScriptMessageRelay=void 0;const n=s(396),r=s(100),a=s(895),i=s(879),o=s(819);class c extends class{constructor(e){this.messageConverter=e,this.awaitingResponse=new Map}acceptContentScriptConnection(e){e.onMessage.addListener((t=>{this.onMessageFromContentScript(e,t)}))}async relayMessageFromApiClient(e,t){await this.postMessageToContentScript(this.messageConverter.convertCAToACS(e)),this.awaitingResponse.set(e.id,t)}handleEventMessage(e,t){return!1}onMessageFromContentScript(e,t){try{const s=this.messageConverter.covertRawCSAToCSA(t);if(this.handleEventMessage(e,s))return;const n=this.awaitingResponse.get(s.requestId);n&&(n.postMessage(this.messageConverter.convertCSAToAC(s)),this.awaitingResponse.delete(s.requestId))}catch(e){return}}}{constructor(e){super(e),this.contentScriptPortsForWindows=new Map,this.eventEmitter=new r.EventEmitter}hasContentScriptConnectionForWindow(e){return!!this.contentScriptPortsForWindows.get(e)}static defaultMessageConverter(){return{convertCAToACS:e=>{switch(e.type){case"CA_CallStartpageFunction":{const t=e;switch(t.functionName){case"TestStartpageFunction":return i.CallTestStartpageFunctionMessage.fromParams(t.id,t.windowId,t.params);case"DisplayTargetedSDSection":return i.DisplayTargetedSDSectionFunctionMessage.fromParams(t.id,t.windowId,t.params);default:throw new Error(`Unrecognized function: ${t.functionName}`)}}default:throw new Error(`Message type ${e.type} does not map to a content script message`)}},covertRawCSAToCSA:e=>{if("CSA_CallStartpageFunctionResponse"===e.type)return i.CSA_CallStartpageFunctionResponseMessage.fromRawMessage(e);if("CSA_StartpageAPIEvent"===e.type)return i.CSA_StartpageAPIEventMessage.fromRawMessage(e);throw new Error("Unknown message received")},convertCSAToAC:e=>{if("CSA_CallStartpageFunctionResponse"!==e.type)throw new Error(`Unsupported message type ${e.type}`);const t=e;return new o.AC_CallStartpageFunctionResponseMessage({result:t.result,data:t.data})}}}on(e,t){this.eventEmitter.on(e,t)}onStartpageEvent(e){this.eventEmitter.on("startpage-script-event",e)}acceptContentScriptConnection(e){const t=e.sender.tab.windowId;if(this.contentScriptPortsForWindows.has(t))return e.postMessage(new i.ACS_ErrorMessage("This window already has an active startpage content script connection")),void e.disconnect();this.contentScriptPortsForWindows.set(t,e),this.eventEmitter.emit("startpage-script-ready",t),e.onDisconnect.addListener((()=>{this.contentScriptPortsForWindows.delete(t)})),super.acceptContentScriptConnection(e)}async postMessageToContentScript(e){const t=e,s=this.contentScriptPortsForWindows.get(t.windowId);s?s.postMessage(t):await new Promise(((e,s)=>{chrome.windows.get(t.windowId,(e=>{e||s(new Error(`No window of id ${t.windowId}`)),s(new Error(`SD content script not ready in window id ${t.windowId}`))}))}))}handleEventMessage(e,t){if("CSA_StartpageAPIEvent"===t.type){const s=t;return this.eventEmitter.emit("startpage-script-event",e.sender.tab.windowId,s.name,s.data),!0}return!1}}t.StartpageContentScriptMessageRelay=c;class d{constructor(e,t,s){this.messageRelay=e,this.apiLevel=t,this.apiName=s,this.activeClients=[]}get apiLevelVariableName(){return`${this.apiName}_api_level`}registerVariables(e,t){e.registerIntVariable(this.apiLevelVariableName,this.apiLevel)}publishApiLevel(e){e.setInt(this.apiLevelVariableName,this.apiLevel)}onClientConnected(e){this.activeClients.push(e)}onClientDisconnected(e){this.activeClients.splice(this.activeClients.indexOf(e),1)}onMessageFromApiClient(e,t){"CA_GetApiLevel"!==t.type?this.messageRelay.relayMessageFromApiClient(t,e).then().catch((t=>{e.postMessage(new a.AC_ErrorMessage(t.message))})):e.postMessage(new o.AC_GetApiLevelResponseMessage(this.apiLevel))}acceptContentScriptConnection(e){this.messageRelay.acceptContentScriptConnection(e)}}t.InjectionBasedPageApi=d;class g extends d{constructor(e,t){super(t,g.API_LEVEL,g.API_PORT_NAME),this.externalConnectionMessageParser=e,this.startpageMessageRelay=t,this.externalConnectionMessageParser.registerMessageParser(o.CA_CallStartpageFunctionMessage.MESSAGE_TYPE,o.CA_CallStartpageFunctionMessage.fromRawMessage),this.externalConnectionMessageParser.registerMessageParser(o.CA_GetInjectedScriptStatusMessage.MESSAGE_TYPE,o.CA_GetInjectedScriptStatusMessage.fromRawMessage),n.reloadStartpagesInAllWindowsWhenInBackground((()=>{})),t.on("startpage-script-ready",(e=>this.onStartpageMessageSinkReady(e))),t.onStartpageEvent(((e,t,s)=>this.onStartpageEvent(e,t,s)))}onMessageFromApiClient(e,t){"CA_GetInjectedScriptStatus"!==t.type?super.onMessageFromApiClient(e,t):e.postMessage(new o.AC_GetInjectedScriptStatusResponseMessage(this.startpageMessageRelay.hasContentScriptConnectionForWindow(t.windowId)))}onStartpageMessageSinkReady(e){this.activeClients.forEach((t=>{t.postMessage(new o.AC_WindowScriptsReadyMessage(e))}))}onStartpageEvent(e,t,s){this.activeClients.forEach((n=>{n.postMessage(new o.AC_StartpageAPIEvent(e,t,s))}))}}t.InjectionBasedStartpageApi=g,g.API_PORT_NAME="sd_cs",g.API_LEVEL=2,t.InjectionBasedPageApiManager=class{constructor(e,t,s){this.pageApis=s,t.registerMessageParser(o.CA_GetApiLevelMessage.MESSAGE_TYPE,(()=>new o.CA_GetApiLevelMessage)),this.registerApisWithBroker(e),chrome.runtime.onConnect.addListener((e=>{const t=this.pageApis.get(e.name);if(!t)return e.postMessage(new i.ACS_ErrorMessage(`Content script claims to serve an API '${e.name}' that does not exist`)),void e.disconnect();t.acceptContentScriptConnection(e)}))}registerApisWithBroker(e){this.pageApis.forEach(((t,s)=>{e.registerConnectionListener(s,(e=>{t.onClientConnected(e),e.onMessage((s=>{t.onMessageFromApiClient(e,s)})),e.onDisconnect((()=>{t.onClientDisconnected(e)}))}))}))}static defaultServicedApiMap(e){const t=new Map;return t.set(g.API_PORT_NAME,new g(e,new c(c.defaultMessageConverter()))),t}static registerVariables(e,t){t.forEach(((t,s)=>{t.registerVariables(e,s)}))}}},819:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AC_GetInjectedScriptStatusResponseMessage=t.AC_GetApiLevelResponseMessage=t.AC_StartpageAPIEvent=t.AC_CallStartpageFunctionResponseMessage=t.AC_WindowScriptsReadyMessage=t.CA_CallStartpageFunctionMessage=t.UseInjectionBasedApiMessage=t.CA_GetInjectedScriptStatusMessage=t.CA_GetApiLevelMessage=t.ClientToApiInjectionBasedApiMessage=void 0;const n=s(817),r=s(895),a=s(895);class i extends r.ExternalConnectionClientToApiMessage{}t.ClientToApiInjectionBasedApiMessage=i;class o extends i{constructor(){super(o.MESSAGE_TYPE)}}t.CA_GetApiLevelMessage=o,o.MESSAGE_TYPE="CA_GetApiLevel";class c extends i{constructor(e){super(c.MESSAGE_TYPE),this.windowId=e}static fromRawMessage(e){const t=e.windowId;if("number"!=typeof t)throw new Error("windowId invalid");return new c(t)}}t.CA_GetInjectedScriptStatusMessage=c,c.MESSAGE_TYPE="CA_GetInjectedScriptStatus";class d extends i{constructor(e,t){super(e),this.functionName=t}}t.UseInjectionBasedApiMessage=d;class g extends d{constructor(e,t,s){super(g.MESSAGE_TYPE,e),this.windowId=t,this.params=s}static fromRawMessage(e){const t=e.functionName;if(t!==n.TEST_STARTPAGE_FUNCTION&&t!==n.DISPLAY_TARGETED_SD_SECTION_FUNCTION)throw new Error(`functionName invalid: ${t}`);const s=e.windowId;if("number"!=typeof s)throw new Error("windowId invalid");const r=e.params;if("object"!=typeof r)throw new Error("params should be an object");const a=new Map;for(const e in r)a.set(e,r[e]);return new g(t,s,a)}}t.CA_CallStartpageFunctionMessage=g,g.MESSAGE_TYPE="CA_CallStartpageFunction";class h extends a.ExternalConnectionApiToClientMessage{constructor(e){super(h.MESSAGE_TYPE),this.windowId=e}}t.AC_WindowScriptsReadyMessage=h,h.MESSAGE_TYPE="AC_WindowScriptsReady";class l extends a.ExternalConnectionApiToClientMessage{constructor(e){super(l.MESSAGE_TYPE),this.data=e}}t.AC_CallStartpageFunctionResponseMessage=l,l.MESSAGE_TYPE="AC_CallStartpageFunctionResponse";class p extends a.ExternalConnectionApiToClientMessage{constructor(e,t,s){super(p.MESSAGE_TYPE),this.windowId=e,this.name=t,this.data=s}}t.AC_StartpageAPIEvent=p,p.MESSAGE_TYPE="AC_StartpageAPIEvent";class u extends a.ExternalConnectionApiToClientMessage{constructor(e){super(u.MESSAGE_TYPE),this.apiLevel=e}}t.AC_GetApiLevelResponseMessage=u,u.MESSAGE_TYPE="AC_GetApiLevelResponse";class v extends a.ExternalConnectionApiToClientMessage{constructor(e){super(v.MESSAGE_TYPE),this.scriptsReady=e}}t.AC_GetInjectedScriptStatusResponseMessage=v,v.MESSAGE_TYPE="AC_GetInjectedScriptStatusResponse"},817:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DISPLAY_TARGETED_SD_SECTION_FUNCTION=t.TEST_STARTPAGE_FUNCTION=void 0,t.TEST_STARTPAGE_FUNCTION="TestStartpageFunction",t.DISPLAY_TARGETED_SD_SECTION_FUNCTION="DisplayTargetedSDSection"},1:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TabChangedEventSource=void 0;class s{constructor(e,t,s,n){this.fireEvent=e,this.onTabActivated=t,this.tabsGetFunction=s,this.variableStore=n}static registerVariables(e){for(const t in this.VARIABLES)e.registerStringVariable(t,this.VARIABLES[t].default)}async listener(e){const t=await new Promise((t=>this.tabsGetFunction(e.tabId,t)));await this.variableStore.setString("last_navigation",t.url),this.fireEvent({eventName:s.NAME,windowId:e.windowId})}async activate(){this.listenerObject=this.listener.bind(this),this.onTabActivated.addListener(this.listenerObject)}async deactivate(){this.onTabActivated.removeListener(this.listenerObject),this.listenerObject=null}}t.TabChangedEventSource=s,s.VARIABLES={last_navigation:{default:"none",description:"Last navigated url"}},s.NAME="tab-changed"},358:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TemporaryPatches=void 0;class s{constructor(){opr.browserSidebarPrivate&&opr.browserSidebarPrivate.onItemExpanded&&opr.browserSidebarPrivate.onItemExpanded.addListener(this.onItemExpanded)}onItemExpanded(e){e===s.LASTCARD_ID&&chrome.runtime.sendMessage(s.LASTCARD_ID,{type:"ToggleRedDot",data:!1})}}s.LASTCARD_ID="niedpkpgcoojodjamdaecieijchonfnm",t.TemporaryPatches=class{constructor(){this.lastpass=new s}}},824:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VariableRegistry=void 0,t.VariableRegistry=class{constructor(){this._variables=new Map}get variables(){return this._variables}registerIntVariable(e,t){this.variables.set(e,t)}registerStringVariable(e,t){this.variables.set(e,t)}}},291:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VariableStore=void 0;class s{constructor(e,t){this.storage=e,this.settings=t}static async saveInternal(e,t){await new Promise((s=>e.set(t,s)))}async setInt(e,t,s){if(!(e in this.settings.trigger_variables.int))throw new Error("Attempted to set an unregistered int variable: "+e);this.settings.trigger_variables.int[e]=t,void 0!==s&&"flush"!==s||await this.save()}async setString(e,t,s){if(!(e in this.settings.trigger_variables.string))throw new Error("Attempted to set an unregistered int variable: "+e);this.settings.trigger_variables.string[e]=t,void 0!==s&&"flush"!==s||await this.save()}getInt(e){const t=this.settings.trigger_variables.int[e];if(void 0===t)throw new Error("Variable not registered");return t}getString(e){const t=this.settings.trigger_variables.string[e];if(void 0===t)throw new Error("Variable not registered");return t}async save(){await s.saveInternal(this.storage,this.settings)}static async load(e,t){var n;const r={trigger_variables:null!==(n=(await new Promise((t=>e.get((e=>t(e)))))).trigger_variables)&&void 0!==n?n:{int:{},string:{}}};return["int","string"].forEach((e=>{const s=new Set;for(const n in r.trigger_variables[e])(()=>{const s=t.variables.get(n);return(s?"string"==typeof s?"string":"int":"none")!==e})()&&s.add(n);s.forEach((t=>{delete r.trigger_variables[e][t]}))})),t.variables.forEach(((e,t)=>{const s="string"==typeof e?"string":"int",n="string"==typeof e?"int":"string";t in r.trigger_variables[s]||(r.trigger_variables[s][t]=e),t in r.trigger_variables[n]&&delete r.trigger_variables[n][t]})),await s.saveInternal(e,r),new s(e,r)}}t.VariableStore=s}},t={};function s(n){var r=t[n];if(void 0!==r)return r.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,s),a.exports}(()=>{const e=s(727),t=s(533),n=s(1),r=s(824),a=s(291),i=s(722),o=s(166),c=s(410),d=s(842),g=s(907),h=s(783),l=s(796),p=s(89),u=s(683),v=s(895),w=s(358);document.addEventListener("DOMContentLoaded",(async()=>{const s=new v.ExternalConnectionMessageParser,m=p.InjectionBasedPageApiManager.defaultServicedApiMap(s),f=new r.VariableRegistry;n.TabChangedEventSource.registerVariables(f),h.CashbackBadgeShownEventSource.registerVariables(f),p.InjectionBasedPageApiManager.registerVariables(f,m);const S=await o.HistoryTagStorage.readHistoryTagsFromJson("history-tags.json");o.HistoryTagStorage.registerVariables(f,S);const C=await a.VariableStore.load(chrome.storage.local,f);m.forEach((e=>e.publishApiLevel(C)));const E=new u.ExternalConnectionBroker(s,u.defaultExternalConnectionPortFactory);document.injectionBasedPageApiManager=new p.InjectionBasedPageApiManager(E,s,m);const _=new Map;_.set(n.TabChangedEventSource.NAME,(()=>new n.TabChangedEventSource(opr.richHintsAgentPrivate.fireEvent,chrome.tabs.onActivated,chrome.tabs.get,C))),h.CashbackBadgeShownEventSource.isAvailable()&&_.set(h.CashbackBadgeShownEventSource.NAME,(()=>new h.CashbackBadgeShownEventSource(C)));const A=await o.HistoryTagStorage.load("history_tags",C),y=new i.HistoryTagUpdater(A,S,18e5),b=Date.now(),M=await l.checkExtensionLaunchType();for(const e of S){const t=await g.HistoryTagEventsBackend.make(g.HistoryTagEventsBackend.getDefaultStorageKey(e.tag),b,M,e.tag,y,A);_.set(c.BrowserLaunchedWithTagAssigned.eventNameForTag(e.tag),(()=>new c.BrowserLaunchedWithTagAssigned(t))),_.set(d.HistoryTagAssignedEventSource.eventNameForTag(e.tag),(()=>new d.HistoryTagAssignedEventSource(t)))}const T=new t.EventSourceFactoryImpl(_);document.eventRegistry=new e.EventRegistry(opr.richHintsAgentPrivate.onSpecificationUpdated,opr.richHintsAgentPrivate.provideEvents,T),document.patches=new w.TemporaryPatches,y.init(document.eventRegistry),document.eventRegistry.registerEvents()}),!1)})()})();