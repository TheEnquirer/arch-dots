(()=>{"use strict";var e={951:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Prefs=void 0;const s="speeddial.bigger_tiles",i="ui.browser.sidebar.visible";class n{constructor(e,t,s,i){this._useBiggerTiles=e,this._sidebarVisible=t,this._adjustColumnsPref=s,this._speeddialColumnCountPref=i,this.listeners=new Map,chrome.settingsPrivate.onPrefsChanged.addListener((e=>this.onPrefsChanged(e)))}static async make(){return new n((await n.get(s)).value,(await n.get(i)).value,(await n.get("startpage.adjust_columns")).value,(await n.get("speeddial.column_count")).value)}get useBiggerTiles(){return this._useBiggerTiles}get sidebarVisible(){return this._sidebarVisible}get adjustColumnsPref(){return this._adjustColumnsPref}get speeddialColumnCountPref(){return this._speeddialColumnCountPref}static async get(e){return new Promise((t=>{chrome.settingsPrivate.getPref(e,(e=>{t(e)}))}))}onPrefsChanged(e){var t;for(let n of e){n.key===s?this._useBiggerTiles=n.value:n.key===i&&(this._sidebarVisible=n.value);for(let e of null!==(t=this.listeners.get(n.key))&&void 0!==t?t:[])e(n.key)}}addListener(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}removeListener(e,t){const s=this.listeners.get(e);if(!s)return;const i=s.indexOf(t);-1!==i&&s.splice(i,1)}}t.Prefs=n},135:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StartpageGridSizeCalculator=void 0,t.StartpageGridSizeCalculator=class{constructor(e){this.prefs=e,this.MIN_COLUMN_COUNT=2,this.MIN_ROW_COUNT=1,this.Sizes={Navbar:{get WIDTH(){return 0}},Scrollbar:{WIDTH:12},Tile:{WIDTH:e=>e.useBiggerTiles?188:140,HEIGHT:e=>e.useBiggerTiles?89:66,TITLE_HEIGHT:32},Grid:{VERTICAL_SPACING:e=>e.useBiggerTiles?16:12,HORIZONTAL_SPACING:e=>e.useBiggerTiles?28:20,MARGIN:e=>e.useBiggerTiles?50:45},GridTitle:{FONT_HEIGHT:17,MARGIN_HEIGHT:16},Bookmarks:{SIDEBAR_WIDTH:232}}}getSuggestedColumnCount(){const e=this.prefs.sidebarVisible?0:this.Sizes.Navbar.WIDTH,t=window.innerWidth-2*this.Sizes.Grid.MARGIN(this.prefs)-e-this.Sizes.Scrollbar.WIDTH,s=Math.floor((t+this.Sizes.Grid.HORIZONTAL_SPACING(this.prefs))/(this.Sizes.Tile.WIDTH(this.prefs)+this.Sizes.Grid.HORIZONTAL_SPACING(this.prefs))),i=this.prefs.adjustColumnsPref,n=i?6:this.prefs.speeddialColumnCountPref,r=Math.min(s,n);return i?2*Math.floor(r/2):r}getDimensions(e){let t=this.getSuggestedColumnCount();t=Math.max(this.MIN_COLUMN_COUNT,t);const s=this.getWidth(e),i=Math.max(this.MIN_ROW_COUNT,1),n=this.getHeight(i),r=this.getWidth(t);return{columnCount:t,rowCount:i,width:s,height:n,containerWidth:r,outerContainerWidth:r+2*this.Sizes.Grid.MARGIN(this.prefs)}}calculatePositions(e,t){const s=[];for(let i=0;i<e;i++){const e=t.rowCount>1?i%t.columnCount:i,n=t.rowCount>1?Math.floor(i/t.columnCount):0,r=e*(this.Sizes.Tile.WIDTH(this.prefs)+this.Sizes.Grid.HORIZONTAL_SPACING(this.prefs)),o=n*(this.Sizes.Tile.HEIGHT(this.prefs)+this.Sizes.Tile.TITLE_HEIGHT+this.Sizes.Grid.VERTICAL_SPACING(this.prefs));s.push({left:r,top:o})}return s}getWidth(e){return e*this.Sizes.Tile.WIDTH(this.prefs)+(e-1)*this.Sizes.Grid.HORIZONTAL_SPACING(this.prefs)}getHeight(e){return e*(this.Sizes.Tile.HEIGHT(this.prefs)+this.Sizes.Tile.TITLE_HEIGHT)+(e-1)*this.Sizes.Grid.VERTICAL_SPACING(this.prefs)}}}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,s),r.exports}(()=>{const e=s(951),t=s(135);function i(e,t={}){window.postMessage({type:"show_section_event",name:"TargetedSDSection_"+e,data:t},"chrome://startpage")}class n{constructor(e,t,s,n,r,o,l){this.rhMainContainer=e;let[a,c]=this.createRelativeRoot();e.appendChild(a);let d=this.createFoldableSection(r);c.appendChild(d),d.appendChild(this.createHeader(s,(()=>{i(d.classList.contains("folded")?"unfold":"fold"),d.classList.toggle("folded")})));const[u,h]=this.createTilesGrid(o);d.appendChild(u),d.appendChild(this.createIconsSection(n,(()=>{e.innerHTML="",i("menu_option_clicked")}))),window.addEventListener("resize",(()=>{this.layoutTiles(t,h,o)}));for(let e of["speeddial.bigger_tiles","speeddial.column_count","startpage.adjust_columns","ui.browser.sidebar.visible"])l.addListener(e,(()=>{this.layoutTiles(t,h,o)}));this.layoutTiles(t,h,o)}remove(){this.rhMainContainer.remove()}createTilesGrid(e){const t=document.createElement("div");t.className="content";const s=document.createElement("div");s.className="tiles-grid",s.style.left="0px",s.id="interest-driven-sd-grid",t.appendChild(s);for(let t of e){const e=this.createSDTile(t);s.appendChild(e),e.onclick=()=>{i("tile_clicked",{tileId:t.clickUrl})},e.onauxclick=e=>{1===e.button&&i("tile_clicked",{tileId:t.clickUrl})}}return t.style.width="auto",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",[t,s]}createIcon(e,t,s,i){let n=document.createElement("div");n.setAttribute("class",e);let r=n.attachShadow({mode:"open"}),o=document.createElement("style");o.innerText="@import url(chrome://op-resources/toolkit/../styleguide/common.css);\n      @import url(chrome://op-resources/toolkit/../styleguide/scrollbars.css);\n      @import url(chrome://op-resources/modules/styleguide/icon.css);",r.appendChild(o);let l=document.createElement("i");return l.classList.add("icon"),l.classList.add("dim"),l.style.webkitMaskImage=t,l.onclick=e=>{chrome.contextMenusPrivate.showMenu(e.clientX,e.clientY,[{type:chrome.contextMenusPrivate.ItemType.NORMAL,title:s,id:0,enabled:!0}],(e=>{0===e&&i()})),e.stopImmediatePropagation(),e.preventDefault()},r.appendChild(l),n}createIconsSection(e,t){let s=document.createElement("section");s.className="icons";let i=this.createIcon("ellipsis",'url("chrome://op-resources/images/styleguide/ellipsis.svg")',e,t),n=this.createIcon("x-close",'url("chrome://op-resources/images/styleguide/close.svg")',e,t);return s.appendChild(i),s.appendChild(n),s}createSDTile(e){const t=document.createElement("a");t.href=e.clickUrl,t.draggable=!1,t.className="tile";const s=document.createElement("div");s.className="tile-main",t.appendChild(s);const i=document.createElement("div");i.className="tile-content",i.style.backgroundImage=`url(${e.imageUrl})`,s.appendChild(i);const n=document.createElement("div");n.className="tile-container",s.appendChild(n);const r=document.createElement("span");return r.className="title",r.innerText=e.title,n.appendChild(r),t}layoutTiles(e,t,s){const i=e.getDimensions(s.length);t.style.width=i.containerWidth+"px",t.style.height=i.height+"px";let n=e.calculatePositions(s.length,i);t.childNodes.forEach(((e,t)=>{e.style.transform=`translateX(${n[t].left}px)`,e.style.display=t>=i.columnCount?"none":""}))}createTitleSpans(e){let t=[],s=`=${e}=`.split("*"),i=!1;for(let e of s){if(e=e.replace(/=/g,""),0===e.length)continue;const s=document.createElement("span");i&&(s.style.fontWeight="700"),s.innerText=e,t.push(s),i=!i}return t}createHeader(e,t){const s=document.createElement("h2");s.className="header",s.onclick=()=>t();const i=document.createElement("section");i.className="title",i.style.gap="0.3em";for(let t of this.createTitleSpans(e))i.appendChild(t);const n=document.createElement("span");n.className="chevron";const r=document.createElement("span");return r.className="chevron-icon",n.appendChild(r),i.appendChild(n),s.appendChild(i),s}createFoldableSection(e){const t=document.createElement("main");return t.className="foldable",e&&t.classList.toggle("folded"),t}createRelativeRoot(){const e=document.createElement("div"),t=e.attachShadow({mode:"open"});e.style.position="relative";const s=document.createElement("style");return s.innerText="@import url(chrome://op-resources/toolkit/../styleguide/common.css);\n      @import url(chrome://op-resources/toolkit/../styleguide/scrollbars.css);\n      @import url(chrome://op-resources/modules/rich_hint_container/rich_hint_container.css);\n      @import url(chrome://op-resources/modules/speeddial/components/speeddial.css);\n      @import url(chrome://op-resources/modules/startpage/components/tiles_grid.css);\n      @import url(chrome://op-resources/modules/startpage/components/tile.css);\n      @import url(chrome://op-resources/modules/styleguide/section.css);\n      :root.bigger-tiles, :host-context(html.bigger-tiles) {\n        --speeddial-tile-height: 89px;\n      }\n      :root, :host\n      {\n        --speeddial-tile-height: 66px;\n      }\n      .folded .ellipsis {\n        display: none;\n      }\n      .x-close {\n        display: none;\n      }\n      .folded .x-close {\n        display: block;\n      }\n      .icons { position: absolute; top: 0px; right: 0px; }\n      .folded .icons {\n        top: 9px; right: 10px;\n      }",t.appendChild(s),[e,t]}static async create(e,t,s,i,r,o){if(!opr.startpageHintsPrivate){let e=-1;try{await new Promise(((t,s)=>{let i=0;e=window.setInterval((()=>{opr.startpageHintsPrivate?t():(++i,i>10&&s())}),100)}))}finally{window.clearInterval(e)}}const l=await new Promise((e=>{opr.startpageHintsPrivate.showSection("below-search",(t=>e(t)))}));if(l.innerHTML="",0!==i.length)return new n(l,e,t,s,r,i,o)}}window.addEventListener("message",(function(s){"show_section"===s.data.type&&async function(s){let i=await e.Prefs.make(),r=new t.StartpageGridSizeCalculator(i);document.targetedSdSectionUi=await n.create(r,s.sectionTitle,s.menuOptionTitle,s.tiles,s.folded,i),window.postMessage({type:"show_section_done"},"chrome://startpage")}(s.data),"agent_disconnected"===s.data.type&&document.targetedSdSectionUi&&document.targetedSdSectionUi.remove()}))})()})();